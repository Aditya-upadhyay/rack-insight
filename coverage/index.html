<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Logical-insight</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.5.3/jquery-1.6.2.min.js' type='text/javascript'></script>
    <script src='./assets/0.5.3/jquery.dataTables.min.js' type='text/javascript'></script>   
    <script src='./assets/0.5.3/fancybox/jquery.fancybox-1.3.1.pack.js' type='text/javascript'></script>   
    <script src='./assets/0.5.3/jquery.timeago.js' type='text/javascript'></script>   
    <script src='./assets/0.5.3/jquery.url.js' type='text/javascript'></script>   
    <script src='./assets/0.5.3/highlight.pack.js' type='text/javascript'></script>  
    <script src='./assets/0.5.3/app.js' type='text/javascript'></script>    
    <link href='./assets/0.5.3/stylesheet.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link href='./assets/0.5.3/highlight.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link href='./assets/0.5.3/fancybox/jquery.fancybox-1.3.1.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link href='./assets/0.5.3/smoothness/jquery-ui-1.8.4.custom.css' media='screen, projection, print' rel='stylesheet' type='text/css'>    
    <link rel="shortcut icon" type="image/png" href="./assets/0.5.3/favicon_green.png" />
    <link rel="icon" type="image/png" href="./assets/0.5.3/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.5.3/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2012-05-17T23:49:51-07:00">2012-05-17T23:49:51-07:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="green">91.46%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         96.64
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>47</b> files in total.
    <b>1546</b> relevant lines. 
    <span class="green"><b>1414</b> lines covered</span> and
    <span class="red"><b>132</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#ae9b874412fb1f6431d0cd40c1086c1092e36264" class="src_link" title="lib/insight.rb">lib/insight.rb</a></td>
        <td class="yellow strong">88.89 %</td>
        <td>17</td>
        <td>9</td>
        <td>8</td>
        <td>1</td>
        <td>19.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7a2f00302e4a0760e15c2ebf748c3a1e5687d3a3" class="src_link" title="lib/insight/app.rb">lib/insight/app.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>198</td>
        <td>130</td>
        <td>130</td>
        <td>0</td>
        <td>61.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0b087e1839634405e058dcfac5b7732303b3b6cc" class="src_link" title="lib/insight/database.rb">lib/insight/database.rb</a></td>
        <td class="green strong">92.59 %</td>
        <td>193</td>
        <td>108</td>
        <td>100</td>
        <td>8</td>
        <td>309.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8d2d25cbcc36cc1d649c15a91793fea2cf71a505" class="src_link" title="lib/insight/enable-button.rb">lib/insight/enable-button.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>43</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>3.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d31416faaaa1ec53a2251bd1f41b4a918bc94358" class="src_link" title="lib/insight/filtered_backtrace.rb">lib/insight/filtered_backtrace.rb</a></td>
        <td class="red strong">52.17 %</td>
        <td>45</td>
        <td>23</td>
        <td>12</td>
        <td>11</td>
        <td>2.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#33e97f78996085fb8a33c3ae10f169f7e9cd8ad5" class="src_link" title="lib/insight/instrumentation.rb">lib/insight/instrumentation.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>8</td>
        <td>8</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8c584dfa638b6470ff5fc748254a281d180b3d50" class="src_link" title="lib/insight/instrumentation/backstage.rb">lib/insight/instrumentation/backstage.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>205.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#dce09699eeff337a7673465b1e66eb2c02455af3" class="src_link" title="lib/insight/instrumentation/client.rb">lib/insight/instrumentation/client.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>38.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#eb1e7ecdfa56c2702a37a11f7d0bff666be69a54" class="src_link" title="lib/insight/instrumentation/instrument.rb">lib/insight/instrumentation/instrument.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>109</td>
        <td>62</td>
        <td>62</td>
        <td>0</td>
        <td>92.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#42a627e7f2716ac729ea452902e7a2306e627370" class="src_link" title="lib/insight/instrumentation/package-definition.rb">lib/insight/instrumentation/package-definition.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>58</td>
        <td>32</td>
        <td>32</td>
        <td>0</td>
        <td>222.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a5a76291ef155bdb7812544878cb0a198344c200" class="src_link" title="lib/insight/instrumentation/probe-definition.rb">lib/insight/instrumentation/probe-definition.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>254.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ad565915b65cc2cbe8ba77a0f1ca21e1d499899f" class="src_link" title="lib/insight/instrumentation/probe.rb">lib/insight/instrumentation/probe.rb</a></td>
        <td class="green strong">98.17 %</td>
        <td>196</td>
        <td>109</td>
        <td>107</td>
        <td>2</td>
        <td>305.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ad42fe0d6cac46cb6edea2edb02be543f8298887" class="src_link" title="lib/insight/instrumentation/setup.rb">lib/insight/instrumentation/setup.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>32</td>
        <td>20</td>
        <td>20</td>
        <td>0</td>
        <td>52.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4829be6d9801e141549822c7a7c80687d8bd3725" class="src_link" title="lib/insight/logger.rb">lib/insight/logger.rb</a></td>
        <td class="green strong">97.06 %</td>
        <td>53</td>
        <td>34</td>
        <td>33</td>
        <td>1</td>
        <td>1180.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#01be41f4857c272c30aca7b3547e11da96800710" class="src_link" title="lib/insight/options.rb">lib/insight/options.rb</a></td>
        <td class="yellow strong">86.27 %</td>
        <td>116</td>
        <td>51</td>
        <td>44</td>
        <td>7</td>
        <td>242.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5a6acdcd4236f51744f626c6e5c549803cf32e18" class="src_link" title="lib/insight/panel.rb">lib/insight/panel.rb</a></td>
        <td class="green strong">95.38 %</td>
        <td>121</td>
        <td>65</td>
        <td>62</td>
        <td>3</td>
        <td>176.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5a44888c7744d241d7a9526bbd2b865dfe83bfe0" class="src_link" title="lib/insight/panel_app.rb">lib/insight/panel_app.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>31</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>14.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2cd4a0a8402bbecc0e258ff7ef1ced5132c42383" class="src_link" title="lib/insight/panels-content.rb">lib/insight/panels-content.rb</a></td>
        <td class="red strong">46.15 %</td>
        <td>22</td>
        <td>13</td>
        <td>6</td>
        <td>7</td>
        <td>13.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a31faff1d0f3f943a31af37b779d0c0cf09bd62c" class="src_link" title="lib/insight/panels-header.rb">lib/insight/panels-header.rb</a></td>
        <td class="red strong">54.55 %</td>
        <td>18</td>
        <td>11</td>
        <td>6</td>
        <td>5</td>
        <td>16.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#dbfdccfe7e98985801ebd71866db06d6dc3bb235" class="src_link" title="lib/insight/panels/active_record_panel.rb">lib/insight/panels/active_record_panel.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>46</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>39.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6bfeccd6ad7300157d3c6aa071bf36a19a715799" class="src_link" title="lib/insight/panels/cache_panel.rb">lib/insight/panels/cache_panel.rb</a></td>
        <td class="green strong">97.22 %</td>
        <td>69</td>
        <td>36</td>
        <td>35</td>
        <td>1</td>
        <td>40.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7e8393d819634626092248a648eca59b55952d34" class="src_link" title="lib/insight/panels/cache_panel/panel_app.rb">lib/insight/panels/cache_panel/panel_app.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>46</td>
        <td>26</td>
        <td>26</td>
        <td>0</td>
        <td>6.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3b98fa9292bb23d0d7bfb56d7b304e587a9e83fd" class="src_link" title="lib/insight/panels/cache_panel/stats.rb">lib/insight/panels/cache_panel/stats.rb</a></td>
        <td class="green strong">96.36 %</td>
        <td>98</td>
        <td>55</td>
        <td>53</td>
        <td>2</td>
        <td>18.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9c428b30089b69e84746a9ac0090a1b2e5b87a89" class="src_link" title="lib/insight/panels/log_panel.rb">lib/insight/panels/log_panel.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>53</td>
        <td>29</td>
        <td>29</td>
        <td>0</td>
        <td>14.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3704f646b348bb4a80d31e153567d3bb834452c1" class="src_link" title="lib/insight/panels/memory_panel.rb">lib/insight/panels/memory_panel.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>36</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>36.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#14c40a96e85934dadd57a940af3dfe299ff465ec" class="src_link" title="lib/insight/panels/rails_info_panel.rb">lib/insight/panels/rails_info_panel.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>32.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a6183df34cb20f3872644b6fbb59d8c9aabb21e7" class="src_link" title="lib/insight/panels/redis_panel.rb">lib/insight/panels/redis_panel.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>42</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>6.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0a87b1baa05c3170e9c45a6d80cc9dc3416f8e97" class="src_link" title="lib/insight/panels/redis_panel/redis_extension.rb">lib/insight/panels/redis_panel/redis_extension.rb</a></td>
        <td class="red strong">10.0 %</td>
        <td>23</td>
        <td>10</td>
        <td>1</td>
        <td>9</td>
        <td>0.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8b84834288c901ee5a69413e9fdee7a4d7a342a4" class="src_link" title="lib/insight/panels/redis_panel/stats.rb">lib/insight/panels/redis_panel/stats.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>50</td>
        <td>28</td>
        <td>28</td>
        <td>0</td>
        <td>4.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3bf1de99b86f43309182b62125590148c5f3fa75" class="src_link" title="lib/insight/panels/request_variables_panel.rb">lib/insight/panels/request_variables_panel.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>70</td>
        <td>37</td>
        <td>37</td>
        <td>0</td>
        <td>253.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#99e761c7ba5745091438f4a5d4e401b51b89aa39" class="src_link" title="lib/insight/panels/speedtracer_panel.rb">lib/insight/panels/speedtracer_panel.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>89</td>
        <td>50</td>
        <td>50</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9601af9428ef52c6f9d20102f5b26296dde0ba9d" class="src_link" title="lib/insight/panels/speedtracer_panel/trace-app.rb">lib/insight/panels/speedtracer_panel/trace-app.rb</a></td>
        <td class="red strong">52.63 %</td>
        <td>52</td>
        <td>19</td>
        <td>10</td>
        <td>9</td>
        <td>0.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#27f740fb1d87989d7ff22fa78ab3d4ad8030591d" class="src_link" title="lib/insight/panels/speedtracer_panel/tracer.rb">lib/insight/panels/speedtracer_panel/tracer.rb</a></td>
        <td class="red strong">63.92 %</td>
        <td>213</td>
        <td>97</td>
        <td>62</td>
        <td>35</td>
        <td>0.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1f9987f7b642c852956c0fad308087b10879b5a7" class="src_link" title="lib/insight/panels/sql_panel.rb">lib/insight/panels/sql_panel.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>53</td>
        <td>27</td>
        <td>27</td>
        <td>0</td>
        <td>61.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3893fd71f809d10bf38d2863e3c660e196548ea9" class="src_link" title="lib/insight/panels/sql_panel/panel_app.rb">lib/insight/panels/sql_panel/panel_app.rb</a></td>
        <td class="red strong">77.27 %</td>
        <td>37</td>
        <td>22</td>
        <td>17</td>
        <td>5</td>
        <td>1.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3a3dc28cc95a8c52d10d425f887303f6309a2d1b" class="src_link" title="lib/insight/panels/sql_panel/query.rb">lib/insight/panels/sql_panel/query.rb</a></td>
        <td class="red strong">74.0 %</td>
        <td>94</td>
        <td>50</td>
        <td>37</td>
        <td>13</td>
        <td>1.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5288439a3472649b15047243f094ec72c405f3b7" class="src_link" title="lib/insight/panels/templates_panel.rb">lib/insight/panels/templates_panel.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>58</td>
        <td>30</td>
        <td>30</td>
        <td>0</td>
        <td>32.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2625847df18fb0ba759df20526274737c9d86d3e" class="src_link" title="lib/insight/panels/templates_panel/rendering.rb">lib/insight/panels/templates_panel/rendering.rb</a></td>
        <td class="green strong">92.5 %</td>
        <td>81</td>
        <td>40</td>
        <td>37</td>
        <td>3</td>
        <td>10.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a1d25d8922fbfef97f801fb247fc1b4818b1cec0" class="src_link" title="lib/insight/panels/timer_panel.rb">lib/insight/panels/timer_panel.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>40</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>38.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2f2f36242edc54f10d0b0df7777ddf3fe4c08968" class="src_link" title="lib/insight/params_signature.rb">lib/insight/params_signature.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>61</td>
        <td>32</td>
        <td>32</td>
        <td>0</td>
        <td>27.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#887235ba1a298cac744fcdda6337f05e47885dbb" class="src_link" title="lib/insight/path-filter.rb">lib/insight/path-filter.rb</a></td>
        <td class="yellow strong">84.62 %</td>
        <td>23</td>
        <td>13</td>
        <td>11</td>
        <td>2</td>
        <td>34.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#89c49cb34855886dbb9fd06f3d0cbf67a22468da" class="src_link" title="lib/insight/rack_static_bug_avoider.rb">lib/insight/rack_static_bug_avoider.rb</a></td>
        <td class="red strong">44.44 %</td>
        <td>16</td>
        <td>9</td>
        <td>4</td>
        <td>5</td>
        <td>0.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#934c41dc89d627c040d5e09a7ccc8395eafd1abb" class="src_link" title="lib/insight/redirect_interceptor.rb">lib/insight/redirect_interceptor.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>25</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>24.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ad347f56a5e4bb4c2f66de6ebd1acdccf6fbcba7" class="src_link" title="lib/insight/render.rb">lib/insight/render.rb</a></td>
        <td class="green strong">91.67 %</td>
        <td>72</td>
        <td>36</td>
        <td>33</td>
        <td>3</td>
        <td>535.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#84f6f7469cd9985c72f9b32cdf91b911abeeccdc" class="src_link" title="lib/insight/request-recorder.rb">lib/insight/request-recorder.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>23</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>38.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a346209d926c6bc1b6984ed0bcf97108a66ec869" class="src_link" title="lib/insight/toolbar.rb">lib/insight/toolbar.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>69</td>
        <td>35</td>
        <td>35</td>
        <td>0</td>
        <td>66.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ee5f27329dbb4fb81e60ca758dfd2cc39372d0c7" class="src_link" title="lib/logical-insight.rb">lib/logical-insight.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.6.4 
        and simplecov-html v0.5.3<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="ae9b874412fb1f6431d0cd40c1086c1092e36264">
  <div class="header">
    <h3>lib/insight.rb</h3>
    <h4><span class="yellow">88.89 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class &lt;&lt; self</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def enable</code>
        </li>
      
        <li class="covered" data-hits="165" data-linenumber="4">
          <span class="hits">165</span>
          
          <code class="ruby">      Thread.current[&quot;insight.enabled&quot;] = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    def disable</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">      Thread.current[&quot;insight.enabled&quot;] = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    def enabled?</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="12">
          <span class="hits">6</span>
          
          <code class="ruby">      Thread.current[&quot;insight.enabled&quot;] == true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/app'</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7a2f00302e4a0760e15c2ebf748c3a1e5687d3a3">
  <div class="header">
    <h3>lib/insight/app.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>130</b> relevant lines. 
      <span class="green"><b>130</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;rack&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;digest/sha1&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;insight/filtered_backtrace&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;insight/options&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;insight/logger&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;insight/panel&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;insight/panel_app&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;insight/params_signature&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;insight/rack_static_bug_avoider&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;insight/redirect_interceptor&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;insight/render&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;insight/toolbar&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;insight/enable-button&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;insight/path-filter&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/logger'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/request-recorder'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/instrumentation/setup'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/panels-content'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/panels-header'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  class App</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    include Options</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    INSIGHT_ROOT = &quot;/__insight__&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    INSIGHT_REGEX = %r{^#{INSIGHT_ROOT}}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    VERSION = &quot;0.4.4&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    class SecurityError &lt; StandardError</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app, options = {}, &amp;block)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      initialize_options options</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      @base_app = app</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">      @panels = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">      instance_eval(&amp;block) if block_given?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">      @logger = Logger.new(read_option(:log_level), read_option(:log_path))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">      Thread.current['insight.logger'] = @logger</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">      build_normal_stack</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">      build_debug_stack</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">      if options[:on_initialize]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">        options[:on_initialize].call(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :logger</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :panels</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    def call(env)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="50">
          <span class="hits">86</span>
          
          <code class="ruby">      @original_request = Rack::Request.new(env)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="51">
          <span class="hits">86</span>
          
          <code class="ruby">      if insight_active?</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="52">
          <span class="hits">80</span>
          
          <code class="ruby">        @env = env</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="53">
          <span class="hits">80</span>
          
          <code class="ruby">        self.options = @default_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="55">
          <span class="hits">80</span>
          
          <code class="ruby">        env['insight.logger'] = @logger</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="56">
          <span class="hits">80</span>
          
          <code class="ruby">        Thread.current['insight.logger'] = @logger</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="58">
          <span class="hits">80</span>
          
          <code class="ruby">        Insight.enable</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="59">
          <span class="hits">80</span>
          
          <code class="ruby">        env[&quot;insight.panels&quot;] = []</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="60">
          <span class="hits">80</span>
          
          <code class="ruby">        @debug_stack.call(env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="62">
          <span class="hits">6</span>
          
          <code class="ruby">        @normal_stack.call(env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">    def reset(new_options=nil)</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="68">
          <span class="hits">85</span>
          
          <code class="ruby">      @env = nil</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="69">
          <span class="hits">85</span>
          
          <code class="ruby">      initialize_options(new_options)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="71">
          <span class="hits">85</span>
          
          <code class="ruby">      Insight::Instrumentation::ClassProbe::all_probes.each do |probe|</code>
        </li>
      
        <li class="covered" data-hits="144" data-linenumber="72">
          <span class="hits">144</span>
          
          <code class="ruby">        probe.clear_collectors</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="74">
          <span class="hits">85</span>
          
          <code class="ruby">      Insight::Instrumentation::InstanceProbe::all_probes.each do |probe|</code>
        </li>
      
        <li class="covered" data-hits="291" data-linenumber="75">
          <span class="hits">291</span>
          
          <code class="ruby">        probe.clear_collectors</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="77">
          <span class="hits">85</span>
          
          <code class="ruby">      Insight::Instrumentation::PackageDefinition.clear_collectors</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="79">
          <span class="hits">85</span>
          
          <code class="ruby">      build_debug_stack</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">    def insight_active?</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="85">
          <span class="hits">86</span>
          
          <code class="ruby">      return (toolbar_requested? &amp;&amp; ip_authorized? &amp;&amp; password_authorized?)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">    def build_normal_stack</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">      builder = Rack::Builder.new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">      builder.use EnableButton, self</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">      builder.run Rack::Cascade.new([ asset_mapped(Rack::Builder.new), @base_app ])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">      @normal_stack = builder.to_app</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">    def build_debug_stack</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="96">
          <span class="hits">86</span>
          
          <code class="ruby">      @panels.clear</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="97">
          <span class="hits">86</span>
          
          <code class="ruby">      builder = Rack::Builder.new</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="98">
          <span class="hits">86</span>
          
          <code class="ruby">      builder.use Toolbar, self</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="99">
          <span class="hits">86</span>
          
          <code class="ruby">      builder.run Rack::Cascade.new([panel_mappings, shortcut_stack(@base_app), collection_stack(@base_app)])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="101">
          <span class="hits">86</span>
          
          <code class="ruby">      @debug_stack = builder.to_app</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">    def panel_mappings</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="105">
          <span class="hits">86</span>
          
          <code class="ruby">      classes = read_option(:panel_classes)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="106">
          <span class="hits">86</span>
          
          <code class="ruby">      root = INSIGHT_ROOT</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="107">
          <span class="hits">86</span>
          
          <code class="ruby">      insight = self</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="108">
          <span class="hits">86</span>
          
          <code class="ruby">      builder = Rack::Builder.new do</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="109">
          <span class="hits">86</span>
          
          <code class="ruby">        classes.each do |panel_class|</code>
        </li>
      
        <li class="covered" data-hits="590" data-linenumber="110">
          <span class="hits">590</span>
          
          <code class="ruby">          panel_class.panel_mappings.each do |path, app|</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="111">
          <span class="hits">76</span>
          
          <code class="ruby">            map [root, path].join(&quot;/&quot;) do</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="112">
          <span class="hits">76</span>
          
          <code class="ruby">              run app</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="116">
          <span class="hits">86</span>
          
          <code class="ruby">        map root + &quot;/panels_content&quot; do</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="117">
          <span class="hits">86</span>
          
          <code class="ruby">          run PanelsContent.new(insight)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="119">
          <span class="hits">86</span>
          
          <code class="ruby">        map root + &quot;/panels_header&quot; do</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="120">
          <span class="hits">86</span>
          
          <code class="ruby">          run PanelsHeader.new(insight)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="123">
          <span class="hits">86</span>
          
          <code class="ruby">      return asset_mapped(builder)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">    def shortcut_stack(app)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="127">
          <span class="hits">86</span>
          
          <code class="ruby">      Rack::Builder.app do</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="128">
          <span class="hits">86</span>
          
          <code class="ruby">        use PathFilter</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="129">
          <span class="hits">86</span>
          
          <code class="ruby">        run app</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">    def collection_stack(app)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="134">
          <span class="hits">86</span>
          
          <code class="ruby">      classes = read_option(:panel_classes)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="135">
          <span class="hits">86</span>
          
          <code class="ruby">      insight_id = self.object_id</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="136">
          <span class="hits">86</span>
          
          <code class="ruby">      panels = self.panels</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">      #Builder makes it impossible to access the panels</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="140">
          <span class="hits">86</span>
          
          <code class="ruby">      app = Instrumentation::Setup.new(app)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="141">
          <span class="hits">86</span>
          
          <code class="ruby">      app = RedirectInterceptor.new(app)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">      #Reversed?  Does it matter?</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="143">
          <span class="hits">86</span>
          
          <code class="ruby">      app = classes.inject(app) do |app, panel_class|</code>
        </li>
      
        <li class="covered" data-hits="590" data-linenumber="144">
          <span class="hits">590</span>
          
          <code class="ruby">        panel = panel_class.new(app)</code>
        </li>
      
        <li class="covered" data-hits="590" data-linenumber="145">
          <span class="hits">590</span>
          
          <code class="ruby">        panels &lt;&lt; panel</code>
        </li>
      
        <li class="covered" data-hits="590" data-linenumber="146">
          <span class="hits">590</span>
          
          <code class="ruby">        panel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="148">
          <span class="hits">86</span>
          
          <code class="ruby">      app = RequestRecorder.new(app)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="149">
          <span class="hits">86</span>
          
          <code class="ruby">      return app</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">    def asset_mapped(builder)</code>
        </li>
      
        <li class="covered" data-hits="87" data-linenumber="153">
          <span class="hits">87</span>
          
          <code class="ruby">      path = public_path</code>
        </li>
      
        <li class="covered" data-hits="87" data-linenumber="154">
          <span class="hits">87</span>
          
          <code class="ruby">      builder.map INSIGHT_ROOT do</code>
        </li>
      
        <li class="covered" data-hits="87" data-linenumber="155">
          <span class="hits">87</span>
          
          <code class="ruby">        run Rack::File.new(path)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="87" data-linenumber="157">
          <span class="hits">87</span>
          
          <code class="ruby">      builder.to_app</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">    def public_path</code>
        </li>
      
        <li class="covered" data-hits="87" data-linenumber="161">
          <span class="hits">87</span>
          
          <code class="ruby">      ::File.expand_path(&quot;../../insight/public/__insight__&quot;, __FILE__)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">    def toolbar_requested?</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="165">
          <span class="hits">86</span>
          
          <code class="ruby">      @original_request.cookies[&quot;insight_enabled&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">    def ip_authorized?</code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="169">
          <span class="hits">84</span>
          
          <code class="ruby">      return true unless options[&quot;insight.ip_masks&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="168" data-linenumber="171">
          <span class="hits">168</span>
          
          <code class="ruby">      logger.debug{ &quot;Checking #{@original_request.ip} against ip_masks&quot; }</code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="172">
          <span class="hits">84</span>
          
          <code class="ruby">      ip = IPAddr.new(@original_request.ip)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="174">
          <span class="hits">84</span>
          
          <code class="ruby">      mask = options[&quot;insight.ip_masks&quot;].find do |ip_mask|</code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="175">
          <span class="hits">84</span>
          
          <code class="ruby">        ip_mask.include?(ip)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="177">
          <span class="hits">84</span>
          
          <code class="ruby">      if mask</code>
        </li>
      
        <li class="covered" data-hits="164" data-linenumber="178">
          <span class="hits">164</span>
          
          <code class="ruby">        logger.debug{ &quot;Matched #{mask}&quot; }</code>
        </li>
      
        <li class="covered" data-hits="82" data-linenumber="179">
          <span class="hits">82</span>
          
          <code class="ruby">        return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="181">
          <span class="hits">4</span>
          
          <code class="ruby">        logger.debug{ &quot;Matched no masks&quot; }</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="182">
          <span class="hits">2</span>
          
          <code class="ruby">        return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">    def password_authorized?</code>
        </li>
      
        <li class="covered" data-hits="82" data-linenumber="187">
          <span class="hits">82</span>
          
          <code class="ruby">      return true unless options[&quot;insight.password&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="189">
          <span class="hits">6</span>
          
          <code class="ruby">      logger.debug{&quot;Checking password&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="191">
          <span class="hits">3</span>
          
          <code class="ruby">      expected_sha = Digest::SHA1.hexdigest [&quot;insight&quot;, options[&quot;insight.password&quot;]].join(&quot;:&quot;)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="192">
          <span class="hits">3</span>
          
          <code class="ruby">      actual_sha = @original_request.cookies[&quot;insight_password&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="194">
          <span class="hits">6</span>
          
          <code class="ruby">      logger.debug{&quot;Password result: #{actual_sha == expected_sha}&quot;}</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="195">
          <span class="hits">3</span>
          
          <code class="ruby">      actual_sha == expected_sha</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0b087e1839634405e058dcfac5b7732303b3b6cc">
  <div class="header">
    <h3>lib/insight/database.rb</h3>
    <h4><span class="green">92.59 %</span> covered</h4>
    <div>
      <b>108</b> relevant lines. 
      <span class="green"><b>100</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require 'sqlite3'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require 'base64'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  class Database</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    module RequestDataClient</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      def key_sql_template(sql)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">        @key_sql_template = sql</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">      def table_setup(name, *keys)</code>
        </li>
      
        <li class="covered" data-hits="520" data-linenumber="13">
          <span class="hits">520</span>
          
          <code class="ruby">        @table = DataTable.new(name, *keys)</code>
        </li>
      
        <li class="covered" data-hits="520" data-linenumber="14">
          <span class="hits">520</span>
          
          <code class="ruby">        if keys.empty?</code>
        </li>
      
        <li class="covered" data-hits="518" data-linenumber="15">
          <span class="hits">518</span>
          
          <code class="ruby">          @key_sql_template = &quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      def store(env, *keys_and_value)</code>
        </li>
      
        <li class="covered" data-hits="369" data-linenumber="20">
          <span class="hits">369</span>
          
          <code class="ruby">        return if env.nil?</code>
        </li>
      
        <li class="covered" data-hits="369" data-linenumber="21">
          <span class="hits">369</span>
          
          <code class="ruby">        request_id = env[&quot;insight.request-id&quot;]</code>
        </li>
      
        <li class="covered" data-hits="369" data-linenumber="22">
          <span class="hits">369</span>
          
          <code class="ruby">        return if request_id.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="369" data-linenumber="24">
          <span class="hits">369</span>
          
          <code class="ruby">        value = keys_and_value[-1]</code>
        </li>
      
        <li class="covered" data-hits="369" data-linenumber="25">
          <span class="hits">369</span>
          
          <code class="ruby">        keys = keys_and_value[0...-1]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="369" data-linenumber="27">
          <span class="hits">369</span>
          
          <code class="ruby">        @table.store(request_id, value, @key_sql_template % keys)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">      def retrieve(request_id)</code>
        </li>
      
        <li class="covered" data-hits="665" data-linenumber="31">
          <span class="hits">665</span>
          
          <code class="ruby">        @table.for_request(request_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      alias retreive retrieve #JDL cannot spell</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">      def table_length</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">        @table.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    class &lt;&lt; self</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">      include Logging</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">      def database_path=(value)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="44">
          <span class="hits">86</span>
          
          <code class="ruby">        @database_path = value || &quot;insight.sqlite&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">      def database_path</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="48">
          <span class="hits">85</span>
          
          <code class="ruby">        @database_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">      def db</code>
        </li>
      
        <li class="covered" data-hits="2775" data-linenumber="52">
          <span class="hits">2775</span>
          
          <code class="ruby">        @db ||= open_database</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">      def reset</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="56">
          <span class="hits">85</span>
          
          <code class="ruby">        @db = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">      def open_database</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="60">
          <span class="hits">85</span>
          
          <code class="ruby">        @db = SQLite3::Database.new(database_path)</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="61">
          <span class="hits">85</span>
          
          <code class="ruby">        @db.execute(&quot;pragma foreign_keys = on&quot;)</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="62">
          <span class="hits">85</span>
          
          <code class="ruby">        @db</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      rescue Object =&gt; ex</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="64">
          
          
          <code class="ruby">        msg = &quot;Issue while loading SQLite DB:&quot; + [ex.class, ex.message, ex.backtrace[0..4]].inspect</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">        logger.error{ msg }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="67">
          
          
          <code class="ruby">        return {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">      if defined?(PhusionPassenger)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">        PhusionPassenger.on_event(:starting_worker_process) do |forked|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">          Insight::Database::open_database if forked</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">    class Table</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">      include Logging</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">      def db</code>
        </li>
      
        <li class="covered" data-hits="2775" data-linenumber="81">
          <span class="hits">2775</span>
          
          <code class="ruby">        Insight::Database.db</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">      def create_keys_clause</code>
        </li>
      
        <li class="covered" data-hits="340" data-linenumber="85">
          <span class="hits">340</span>
          
          <code class="ruby">        &quot;#{@keys.map{|key| &quot;#{key} varchar&quot;}.join(&quot;, &quot;)}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">      def create_sql</code>
        </li>
      
        <li class="covered" data-hits="596" data-linenumber="89">
          <span class="hits">596</span>
          
          <code class="ruby">        &quot;create table #@table_name ( id integer primary key, #{create_keys_clause} )&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">      def execute(*args)</code>
        </li>
      
        <li class="covered" data-hits="5408" data-linenumber="93">
          <span class="hits">5408</span>
          
          <code class="ruby">        logger.info{ ins_args = args.inspect; &quot;(#{[ins_args.length,120].min}/#{ins_args.length})&quot; + ins_args[0..120] }</code>
        </li>
      
        <li class="covered" data-hits="2704" data-linenumber="94">
          <span class="hits">2704</span>
          
          <code class="ruby">        db.execute(*args)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(table_name, *keys)</code>
        </li>
      
        <li class="covered" data-hits="864" data-linenumber="98">
          <span class="hits">864</span>
          
          <code class="ruby">        @table_name = table_name</code>
        </li>
      
        <li class="covered" data-hits="864" data-linenumber="99">
          <span class="hits">864</span>
          
          <code class="ruby">        @keys = keys</code>
        </li>
      
        <li class="covered" data-hits="864" data-linenumber="100">
          <span class="hits">864</span>
          
          <code class="ruby">        if(execute(&quot;select * from sqlite_master where name = ?&quot;, table_name).empty?)</code>
        </li>
      
        <li class="covered" data-hits="1192" data-linenumber="101">
          <span class="hits">1192</span>
          
          <code class="ruby">          logger.warn{ &quot;Initializing a table called #{table_name}&quot; }</code>
        </li>
      
        <li class="covered" data-hits="596" data-linenumber="102">
          <span class="hits">596</span>
          
          <code class="ruby">          execute(create_sql)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">      def select(which_sql, condition_sql)</code>
        </li>
      
        <li class="covered" data-hits="665" data-linenumber="107">
          <span class="hits">665</span>
          
          <code class="ruby">        execute(&quot;select #{which_sql} from #@table_name where #{condition_sql}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">      def fields_sql</code>
        </li>
      
        <li class="covered" data-hits="440" data-linenumber="111">
          <span class="hits">440</span>
          
          <code class="ruby">        &quot;#{@keys.join(&quot;,&quot;)}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="114">
          <span class="hits">1</span>
          
          <code class="ruby">      def insert(values_sql)</code>
        </li>
      
        <li class="covered" data-hits="440" data-linenumber="115">
          <span class="hits">440</span>
          
          <code class="ruby">        execute(&quot;insert into #@table_name(#{fields_sql}) values (#{values_sql})&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">      def keys(name)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="119">
          
          
          <code class="ruby">        execute(&quot;select #{name} from #@table_name&quot;).flatten</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">      def length(where = &quot;1 = 1&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">        execute(&quot;select count(1) from #@table_name where #{where}&quot;).first.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">      def to_a</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="127">
          <span class="hits">66</span>
          
          <code class="ruby">        execute(&quot;select * from #@table_name&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">    class RequestTable &lt; Table</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize()</code>
        </li>
      
        <li class="covered" data-hits="344" data-linenumber="133">
          <span class="hits">344</span>
          
          <code class="ruby">        super(&quot;requests&quot;, &quot;method&quot;, &quot;url&quot;, &quot;date&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">      def store(method, url)</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="137">
          <span class="hits">71</span>
          
          <code class="ruby">        result = insert(&quot;'#{method}', '#{url}', #{Time.now.to_i}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="138">
          <span class="hits">71</span>
          
          <code class="ruby">        db.last_insert_row_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">      def last_request_id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">        execute(&quot;select max(id) from #@table_name&quot;).first.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">      def sweep</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="146">
          <span class="hits">71</span>
          
          <code class="ruby">        execute(&quot;delete from #@table_name where date &lt; #{Time.now.to_i - (60 * 60 * 12)}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">    require 'yaml'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">    class DataTable &lt; Table</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="152">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(name, *keys)</code>
        </li>
      
        <li class="covered" data-hits="520" data-linenumber="153">
          <span class="hits">520</span>
          
          <code class="ruby">        super(name, *(%w{request_id} + keys + %w{value}))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="156">
          <span class="hits">1</span>
          
          <code class="ruby">      def create_keys_clause</code>
        </li>
      
        <li class="covered" data-hits="511" data-linenumber="157">
          <span class="hits">511</span>
          
          <code class="ruby">        non_request_keys = @keys - %w&quot;request_id&quot;</code>
        </li>
      
        <li class="covered" data-hits="1023" data-linenumber="158">
          <span class="hits">1023</span>
          
          <code class="ruby">        sql = non_request_keys.map{|key| &quot;#{key} varchar&quot;}.join(&quot;, &quot;)</code>
        </li>
      
        <li class="covered" data-hits="511" data-linenumber="159">
          <span class="hits">511</span>
          
          <code class="ruby">        sql += &quot;, request_id references requests(id) on delete cascade&quot;</code>
        </li>
      
        <li class="covered" data-hits="511" data-linenumber="160">
          <span class="hits">511</span>
          
          <code class="ruby">        sql</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="163">
          <span class="hits">1</span>
          
          <code class="ruby">      def store(request_id, value, keys_sql = &quot;&quot;)</code>
        </li>
      
        <li class="covered" data-hits="369" data-linenumber="164">
          <span class="hits">369</span>
          
          <code class="ruby">        sql = &quot;'#{encode_value(value)}'&quot;</code>
        </li>
      
        <li class="covered" data-hits="369" data-linenumber="165">
          <span class="hits">369</span>
          
          <code class="ruby">        sql = keys_sql + &quot;, &quot; + sql unless keys_sql.empty?</code>
        </li>
      
        <li class="covered" data-hits="369" data-linenumber="166">
          <span class="hits">369</span>
          
          <code class="ruby">        sql = &quot;#{request_id}, #{sql}&quot;</code>
        </li>
      
        <li class="covered" data-hits="369" data-linenumber="167">
          <span class="hits">369</span>
          
          <code class="ruby">        insert(sql)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">      def encode_value(value)</code>
        </li>
      
        <li class="covered" data-hits="369" data-linenumber="171">
          <span class="hits">369</span>
          
          <code class="ruby">        Base64.encode64(YAML.dump(value))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">      def decode_value(value)</code>
        </li>
      
        <li class="covered" data-hits="519" data-linenumber="175">
          <span class="hits">519</span>
          
          <code class="ruby">        YAML.load(Base64.decode64(value))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">      def retrieve(key_sql)</code>
        </li>
      
        <li class="covered" data-hits="1184" data-linenumber="179">
          <span class="hits">1184</span>
          
          <code class="ruby">        select(&quot;value&quot;, key_sql).map{|value| decode_value(value.first)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">      def for_request(id)</code>
        </li>
      
        <li class="covered" data-hits="665" data-linenumber="183">
          <span class="hits">665</span>
          
          <code class="ruby">        retrieve(&quot;request_id = #{id}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">      def to_a</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="187">
          
          
          <code class="ruby">        super.map do |row|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="188">
          
          
          <code class="ruby">          row[-1] = decode_value(row[-1])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8d2d25cbcc36cc1d649c15a91793fea2cf71a505">
  <div class="header">
    <h3>lib/insight/enable-button.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class EnableButton</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Render</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    MIME_TYPES = [&quot;text/html&quot;, &quot;application/xhtml+xml&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app, insight)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      @app = app</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">      @insight = insight</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    def call(env)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="13">
          <span class="hits">6</span>
          
          <code class="ruby">      @env = env</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="14">
          <span class="hits">6</span>
          
          <code class="ruby">      status, headers, body = @app.call(@env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="16">
          <span class="hits">6</span>
          
          <code class="ruby">      response = Rack::Response.new(body, status, headers)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="18">
          <span class="hits">6</span>
          
          <code class="ruby">      inject_button(response) if okay_to_modify?(env, response)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="20">
          <span class="hits">6</span>
          
          <code class="ruby">      return response.to_a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    def okay_to_modify?(env, response)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="24">
          <span class="hits">6</span>
          
          <code class="ruby">      req = Rack::Request.new(env)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="25">
          <span class="hits">6</span>
          
          <code class="ruby">      content_type, charset = response.content_type.split(&quot;;&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="27">
          <span class="hits">6</span>
          
          <code class="ruby">      response.ok? &amp;&amp; MIME_TYPES.include?(content_type) &amp;&amp; !req.xhr?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    def inject_button(response)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="31">
          <span class="hits">4</span>
          
          <code class="ruby">      full_body = response.body.join</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="32">
          <span class="hits">4</span>
          
          <code class="ruby">      full_body.sub! /&lt;\/body&gt;/, render + &quot;&lt;/body&gt;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="34">
          <span class="hits">4</span>
          
          <code class="ruby">      response[&quot;Content-Length&quot;] = full_body.bytesize.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="36">
          <span class="hits">4</span>
          
          <code class="ruby">      response.body = [full_body]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def render</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="40">
          <span class="hits">4</span>
          
          <code class="ruby">      render_template(&quot;enable-button&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d31416faaaa1ec53a2251bd1f41b4a918bc94358">
  <div class="header">
    <h3>lib/insight/filtered_backtrace.rb</h3>
    <h4><span class="red">52.17 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module FilteredBacktrace</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    def backtrace</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">      @backtrace</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def has_backtrace?</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="9">
          <span class="hits">16</span>
          
          <code class="ruby">      filtered_backtrace.any?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    def filtered_backtrace</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="13">
          <span class="hits">25</span>
          
          <code class="ruby">      @filtered_backtrace ||= @backtrace.grep(FilteredBacktrace.backtrace_regexp)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.backtrace_regexp</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      @backtrace_regexp ||=</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">          if true or (app_root = root_for_backtrace_filtering).nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">            /.*/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">            excludes = %w{vendor}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">            %r{^#{app_root}(?:#{::File::Separator}(?!#{excludes.join(&quot;|&quot;)}).+)$}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="25">
          <span class="hits">10</span>
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.root_for_backtrace_filtering(sub_path = nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">      if defined?(Rails) &amp;&amp; Rails.respond_to?(:root)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">        sub_path ? Rails.root.join(sub_path) : Rails.root</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">        root = if defined?(RAILS_ROOT)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">                 RAILS_ROOT</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">               elsif defined?(ROOT)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">                 ROOT</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">               elsif defined?(Sinatra::Application)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">                 Sinatra::Application.root</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">               else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">                 nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">               end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">        sub_path ? ::File.join(root, sub_path) : root</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="33e97f78996085fb8a33c3ae10f169f7e9cd8ad5">
  <div class="header">
    <h3>lib/insight/instrumentation.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>8</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Instrumentation; end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/instrumentation/instrument'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/instrumentation/probe'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/instrumentation/client'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/instrumentation/setup'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/instrumentation/package-definition'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/instrumentation/probe-definition'</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8c584dfa638b6470ff5fc748254a281d180b3d50">
  <div class="header">
    <h3>lib/insight/instrumentation/backstage.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight::Instrumentation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Backstage</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def backstage</code>
        </li>
      
        <li class="covered" data-hits="409" data-linenumber="4">
          <span class="hits">409</span>
          
          <code class="ruby">      Thread.current[&quot;instrumented_backstage&quot;] = true</code>
        </li>
      
        <li class="covered" data-hits="409" data-linenumber="5">
          <span class="hits">409</span>
          
          <code class="ruby">      yield</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    ensure</code>
        </li>
      
        <li class="covered" data-hits="409" data-linenumber="7">
          <span class="hits">409</span>
          
          <code class="ruby">      Thread.current[&quot;instrumented_backstage&quot;] = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="dce09699eeff337a7673465b1e66eb2c02455af3">
  <div class="header">
    <h3>lib/insight/instrumentation/client.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/instrumentation/package-definition'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight::Instrumentation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  module Client</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    def probe(collector, &amp;block)</code>
        </li>
      
        <li class="covered" data-hits="341" data-linenumber="5">
          <span class="hits">341</span>
          
          <code class="ruby">      ::Insight::Instrumentation::PackageDefinition::probe(collector, &amp;block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def request_start(env, start)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    def before_detect(method_call, arguments)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def after_detect(method_call, timing, arguments, result)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def request_finish(env, status, headers, body, timing)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="eb1e7ecdfa56c2702a37a11f7d0bff666be69a54">
  <div class="header">
    <h3>lib/insight/instrumentation/instrument.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>62</b> relevant lines. 
      <span class="green"><b>62</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/instrumentation/backstage'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/logger'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  module Instrumentation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    class Instrument</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      MethodCall = Struct.new(:call_number, :backtrace, :file, :line, :object, :context, :kind, :method, :thread)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      class Timing</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">        def initialize(request_start, start, finish)</code>
        </li>
      
        <li class="covered" data-hits="177" data-linenumber="10">
          <span class="hits">177</span>
          
          <code class="ruby">          @request_start, @start, @finish = request_start, start, finish</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">        attr_reader :request_start, :start, :finish</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">        def duration</code>
        </li>
      
        <li class="covered" data-hits="109" data-linenumber="16">
          <span class="hits">109</span>
          
          <code class="ruby">          @duration ||= ((@finish - @start) * 1000).to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">        def delta_t</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="20">
          <span class="hits">44</span>
          
          <code class="ruby">          @delta_t ||= ((@start - @request_start) * 1000).to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      @@call_seq = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">      def self.seq_number</code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="27">
          <span class="hits">101</span>
          
          <code class="ruby">        Thread.exclusive do</code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="28">
          <span class="hits">101</span>
          
          <code class="ruby">          return @@call_seq += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize()</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="33">
          <span class="hits">76</span>
          
          <code class="ruby">        @start = Time.now</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="34">
          <span class="hits">76</span>
          
          <code class="ruby">        @collectors = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      include Backstage</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">      include Logging</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">      def run(object, context=&quot;::&quot;, kind=:instance, called_at = caller[0], method = &quot;&lt;unknown&gt;&quot;, args=[], &amp;blk)</code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="42">
          <span class="hits">101</span>
          
          <code class="ruby">        file, line, rest = called_at.split(':')</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="43">
          <span class="hits">202</span>
          
          <code class="ruby">        call_number = backstage{ self.class.seq_number }</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="44">
          <span class="hits">202</span>
          
          <code class="ruby">        method_call = backstage{ MethodCall.new(call_number, caller(1), file, line, object, context, kind, method, Thread::current) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">        #$stderr.puts [method_call.context, method_call.method].inspect</code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="46">
          <span class="hits">101</span>
          
          <code class="ruby">        start_time = Time.now</code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="47">
          <span class="hits">101</span>
          
          <code class="ruby">        backstage do</code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="48">
          <span class="hits">101</span>
          
          <code class="ruby">          start_event(method_call, args)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="50">
          <span class="hits">101</span>
          
          <code class="ruby">        result = blk.call      # execute the provided code block</code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="51">
          <span class="hits">101</span>
          
          <code class="ruby">        backstage do</code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="52">
          <span class="hits">101</span>
          
          <code class="ruby">          finish_event(method_call, args, start_time, result)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">      def collectors_for(method_call)</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="57">
          <span class="hits">202</span>
          
          <code class="ruby">        probe_chain = if method_call.kind == :instance</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="58">
          <span class="hits">174</span>
          
          <code class="ruby">                        InstanceProbe.get_probe_chain(method_call.context)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">                      else</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="60">
          <span class="hits">28</span>
          
          <code class="ruby">                        ClassProbe.get_probe_chain(method_call.context)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">                      end</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="62">
          <span class="hits">202</span>
          
          <code class="ruby">        collectors = probe_chain.inject([]) do |list, probe|</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="63">
          <span class="hits">202</span>
          
          <code class="ruby">          probe.collectors(method_call.method)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="65">
          <span class="hits">202</span>
          
          <code class="ruby">        logger.debug do</code>
        </li>
      
        <li class="covered" data-hits="552" data-linenumber="66">
          <span class="hits">552</span>
          
          <code class="ruby">          &quot;Probe chain for: #{method_call.context} #{method_call.kind} #{method_call.method}:\n  #{collectors.map{|col| col.class.name}.join(&quot;, &quot;)}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="68">
          <span class="hits">202</span>
          
          <code class="ruby">        collectors</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">      def start_event(method_call, arguments)</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="72">
          <span class="hits">202</span>
          
          <code class="ruby">        logger.debug{ &quot;Starting event: #{method_call.context} #{method_call.kind} #{method_call.method}&quot; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="74">
          <span class="hits">101</span>
          
          <code class="ruby">        collectors_for(method_call).each do |collector|</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="75">
          <span class="hits">175</span>
          
          <code class="ruby">          collector.before_detect(method_call, arguments)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">      def finish_event(method_call, arguments, start_time, result)</code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="80">
          <span class="hits">101</span>
          
          <code class="ruby">        timing = Timing.new(@start, start_time, Time.now)</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="81">
          <span class="hits">202</span>
          
          <code class="ruby">        logger.debug{ &quot;Finishing event: #{method_call.context} #{method_call.kind} #{method_call.method}&quot; }</code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="82">
          <span class="hits">101</span>
          
          <code class="ruby">        collectors_for(method_call).each do |collector|</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="83">
          <span class="hits">175</span>
          
          <code class="ruby">          collector.after_detect(method_call, timing, arguments, result)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">      def all_collectors</code>
        </li>
      
        <li class="covered" data-hits="152" data-linenumber="88">
          <span class="hits">152</span>
          
          <code class="ruby">        PackageDefinition.all_collectors</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">      def start(env)</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="92">
          <span class="hits">76</span>
          
          <code class="ruby">        all_collectors.each do |collector|</code>
        </li>
      
        <li class="covered" data-hits="323" data-linenumber="93">
          <span class="hits">323</span>
          
          <code class="ruby">          collector.request_start(env, @start)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">      def finish(env, status, headers, body)</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="98">
          <span class="hits">76</span>
          
          <code class="ruby">        @timing = Timing.new(@start, @start, Time.now)</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="99">
          <span class="hits">76</span>
          
          <code class="ruby">        all_collectors.each do |collector|</code>
        </li>
      
        <li class="covered" data-hits="323" data-linenumber="100">
          <span class="hits">323</span>
          
          <code class="ruby">          collector.request_finish(env, status, headers, body, @timing)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">      def duration</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="105">
          <span class="hits">76</span>
          
          <code class="ruby">        @timing.duration</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="42a627e7f2716ac729ea452902e7a2306e627370">
  <div class="header">
    <h3>lib/insight/instrumentation/package-definition.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>32</b> relevant lines. 
      <span class="green"><b>32</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight::Instrumentation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class PackageDefinition</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class &lt;&lt; self</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">      def start</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="5">
          <span class="hits">76</span>
          
          <code class="ruby">        @started = begin</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="6">
          <span class="hits">76</span>
          
          <code class="ruby">                     probes.each do |probe|</code>
        </li>
      
        <li class="covered" data-hits="372" data-linenumber="7">
          <span class="hits">372</span>
          
          <code class="ruby">                       probe.fulfill_probe_orders</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">                     end</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="9">
          <span class="hits">76</span>
          
          <code class="ruby">                     true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">                   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">      def probes</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="14">
          <span class="hits">76</span>
          
          <code class="ruby">        InstanceProbe.all_probes + ClassProbe.all_probes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">      def clear_collectors</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="18">
          <span class="hits">85</span>
          
          <code class="ruby">        all_collectors.clear</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      def all_collectors</code>
        </li>
      
        <li class="covered" data-hits="919" data-linenumber="22">
          <span class="hits">919</span>
          
          <code class="ruby">        @all_collectors ||= []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">      def add_collector(collector)</code>
        </li>
      
        <li class="covered" data-hits="341" data-linenumber="26">
          <span class="hits">341</span>
          
          <code class="ruby">        unless all_collectors.include?(collector)</code>
        </li>
      
        <li class="covered" data-hits="341" data-linenumber="27">
          <span class="hits">341</span>
          
          <code class="ruby">          all_collectors &lt;&lt; collector</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">      def probe(collector, &amp;block)</code>
        </li>
      
        <li class="covered" data-hits="341" data-linenumber="32">
          <span class="hits">341</span>
          
          <code class="ruby">        add_collector(collector)</code>
        </li>
      
        <li class="covered" data-hits="341" data-linenumber="33">
          <span class="hits">341</span>
          
          <code class="ruby">        definer = self.new(collector)</code>
        </li>
      
        <li class="covered" data-hits="341" data-linenumber="34">
          <span class="hits">341</span>
          
          <code class="ruby">        definer.instance_eval &amp;block</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_class_probe(name)</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="39">
          <span class="hits">100</span>
          
          <code class="ruby">      ClassProbe.probe_for(name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_instance_probe(name)</code>
        </li>
      
        <li class="covered" data-hits="770" data-linenumber="43">
          <span class="hits">770</span>
          
          <code class="ruby">      InstanceProbe.probe_for(name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(collector)</code>
        </li>
      
        <li class="covered" data-hits="341" data-linenumber="47">
          <span class="hits">341</span>
          
          <code class="ruby">      @collector = collector</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :collector</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">    def instrument(name, &amp;block)</code>
        </li>
      
        <li class="covered" data-hits="836" data-linenumber="53">
          <span class="hits">836</span>
          
          <code class="ruby">      definer = ProbeDefinition.new(self, name)</code>
        </li>
      
        <li class="covered" data-hits="836" data-linenumber="54">
          <span class="hits">836</span>
          
          <code class="ruby">      definer.instance_eval(&amp;block) unless block.nil?</code>
        </li>
      
        <li class="covered" data-hits="836" data-linenumber="55">
          <span class="hits">836</span>
          
          <code class="ruby">      return definer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a5a76291ef155bdb7812544878cb0a198344c200">
  <div class="header">
    <h3>lib/insight/instrumentation/probe-definition.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>11</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight::Instrumentation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class ProbeDefinition</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(package, target_name)</code>
        </li>
      
        <li class="covered" data-hits="836" data-linenumber="4">
          <span class="hits">836</span>
          
          <code class="ruby">      @package = package</code>
        </li>
      
        <li class="covered" data-hits="836" data-linenumber="5">
          <span class="hits">836</span>
          
          <code class="ruby">      @target_name = target_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def instance_probe(*method_names)</code>
        </li>
      
        <li class="covered" data-hits="770" data-linenumber="9">
          <span class="hits">770</span>
          
          <code class="ruby">      if probes = @package.get_instance_probe(@target_name)</code>
        </li>
      
        <li class="covered" data-hits="184" data-linenumber="10">
          <span class="hits">184</span>
          
          <code class="ruby">        probes.probe(@package.collector, *method_names)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def class_probe(*method_names)</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="15">
          <span class="hits">100</span>
          
          <code class="ruby">      if probes = @package.get_class_probe(@target_name)</code>
        </li>
      
        <li class="covered" data-hits="73" data-linenumber="16">
          <span class="hits">73</span>
          
          <code class="ruby">        probes.probe(@package.collector, *method_names)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ad565915b65cc2cbe8ba77a0f1ca21e1d499899f">
  <div class="header">
    <h3>lib/insight/instrumentation/probe.rb</h3>
    <h4><span class="green">98.17 %</span> covered</h4>
    <div>
      <b>109</b> relevant lines. 
      <span class="green"><b>107</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Instrumentation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class Probe</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">      module Interpose</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      @@class_list = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">      module ProbeRunner</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">        include Backstage</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">        include Logging</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">        def probe_run(object, context = &quot;::&quot;, kind=:instance, args=[], called_at=caller[1], method_name = nil)</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="14">
          <span class="hits">106</span>
          
          <code class="ruby">          if Thread.current['instrumented_backstage']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">            #warn &quot;probe_run while backstage: #{context}, #{kind},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">            ##{method_name}&quot; unless method_name.to_sym == :add</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">            return yield</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="19">
          <span class="hits">106</span>
          
          <code class="ruby">          instrument = Thread.current['insight.instrument']</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="20">
          <span class="hits">106</span>
          
          <code class="ruby">          result = nil</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="21">
          <span class="hits">106</span>
          
          <code class="ruby">          if instrument.nil?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="22">
          <span class="hits">5</span>
          
          <code class="ruby">            backstage do</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="23">
          <span class="hits">5</span>
          
          <code class="ruby">              result = yield</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="26">
          <span class="hits">202</span>
          
          <code class="ruby">            instrument.run(object, context, kind, called_at, method_name, args){ result = yield }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="28">
          <span class="hits">106</span>
          
          <code class="ruby">          result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">        extend self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      class &lt;&lt; self</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">        include Logging</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">        def class_list</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">          @@class_list ||= begin</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">                             classes = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                             ObjectSpace.each_object(Class) do |klass|</code>
        </li>
      
        <li class="covered" data-hits="958" data-linenumber="40">
          <span class="hits">958</span>
          
          <code class="ruby">                               classes &lt;&lt; klass</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">                             end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">                             classes</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="43">
          <span class="hits">8</span>
          
          <code class="ruby">                           end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">        def get_probe_chain(name)</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="47">
          <span class="hits">202</span>
          
          <code class="ruby">          const = const_from_name(name)</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="48">
          <span class="hits">202</span>
          
          <code class="ruby">          chain = []</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="49">
          <span class="hits">202</span>
          
          <code class="ruby">          const.ancestors.each do |mod|</code>
        </li>
      
        <li class="covered" data-hits="1742" data-linenumber="50">
          <span class="hits">1742</span>
          
          <code class="ruby">            if probes.has_key?(mod.name)</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="51">
          <span class="hits">202</span>
          
          <code class="ruby">              chain &lt;&lt; probes[mod.name]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="54">
          <span class="hits">202</span>
          
          <code class="ruby">          chain</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">        def const_from_name(name)</code>
        </li>
      
        <li class="covered" data-hits="823" data-linenumber="58">
          <span class="hits">823</span>
          
          <code class="ruby">          parts = name.split(&quot;::&quot;)</code>
        </li>
      
        <li class="covered" data-hits="823" data-linenumber="59">
          <span class="hits">823</span>
          
          <code class="ruby">          const = parts.inject(Kernel) do |namespace, part|</code>
        </li>
      
        <li class="covered" data-hits="968" data-linenumber="60">
          <span class="hits">968</span>
          
          <code class="ruby">            namespace.const_get(part)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">        def probes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">          @probes ||= Hash.new do |h,k|</code>
        </li>
      
        <li class="covered" data-hits="621" data-linenumber="66">
          <span class="hits">621</span>
          
          <code class="ruby">            begin</code>
        </li>
      
        <li class="covered" data-hits="621" data-linenumber="67">
          <span class="hits">621</span>
          
          <code class="ruby">              h[k] = self.new(const_from_name(k))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">            rescue NameError</code>
        </li>
      
        <li class="covered" data-hits="1226" data-linenumber="69">
          <span class="hits">1226</span>
          
          <code class="ruby">              logger.warn{ &quot;Cannot find constant: #{k}&quot; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="covered" data-hits="3136" data-linenumber="71">
          <span class="hits">3136</span>
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">        def all_probes</code>
        </li>
      
        <li class="covered" data-hits="322" data-linenumber="75">
          <span class="hits">322</span>
          
          <code class="ruby">          probes.values</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">        def probe_for(const)</code>
        </li>
      
        <li class="covered" data-hits="870" data-linenumber="79">
          <span class="hits">870</span>
          
          <code class="ruby">          probes[const]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(const)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="84">
          <span class="hits">8</span>
          
          <code class="ruby">        @const = const</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="85">
          <span class="hits">8</span>
          
          <code class="ruby">        @probed = {}</code>
        </li>
      
        <li class="covered" data-hits="499" data-linenumber="86">
          <span class="hits">499</span>
          
          <code class="ruby">        @collectors = Hash.new{|h,k| h[k] = []}</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="87">
          <span class="hits">8</span>
          
          <code class="ruby">        @probe_orders = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">      def collectors(key)</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="91">
          <span class="hits">202</span>
          
          <code class="ruby">        @collectors[key.to_sym]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">      def all_collectors</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="95">
          
          
          <code class="ruby">        @collectors.values</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">      def clear_collectors</code>
        </li>
      
        <li class="covered" data-hits="435" data-linenumber="99">
          <span class="hits">435</span>
          
          <code class="ruby">        @collectors.clear</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">      def probe(collector, *methods)</code>
        </li>
      
        <li class="covered" data-hits="257" data-linenumber="103">
          <span class="hits">257</span>
          
          <code class="ruby">        methods.each do |name|</code>
        </li>
      
        <li class="covered" data-hits="516" data-linenumber="104">
          <span class="hits">516</span>
          
          <code class="ruby">          unless @collectors[name.to_sym].include?(collector)</code>
        </li>
      
        <li class="covered" data-hits="516" data-linenumber="105">
          <span class="hits">516</span>
          
          <code class="ruby">            @collectors[name.to_sym] &lt;&lt; collector</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="516" data-linenumber="107">
          <span class="hits">516</span>
          
          <code class="ruby">          @probe_orders &lt;&lt; name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">      def descendants</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">        @descendants ||= self.class.class_list.find_all do |klass|</code>
        </li>
      
        <li class="covered" data-hits="7664" data-linenumber="113">
          <span class="hits">7664</span>
          
          <code class="ruby">          klass.ancestors.include?(@const)</code>
        </li>
      
        <li class="covered" data-hits="1032" data-linenumber="114">
          <span class="hits">1032</span>
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">      def local_method_defs(klass)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="118">
          <span class="hits">11</span>
          
          <code class="ruby">        klass.instance_methods(false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">      def descendants_that_define(method_name)</code>
        </li>
      
        <li class="covered" data-hits="1032" data-linenumber="122">
          <span class="hits">1032</span>
          
          <code class="ruby">        log{{ :descendants =&gt; descendants }}</code>
        </li>
      
        <li class="covered" data-hits="516" data-linenumber="123">
          <span class="hits">516</span>
          
          <code class="ruby">        descendants.find_all do |klass|</code>
        </li>
      
        <li class="covered" data-hits="151" data-linenumber="124">
          <span class="hits">151</span>
          
          <code class="ruby">          (@const != klass and local_method_defs(klass).include?(method_name))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">      include Logging</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">      def log &amp;block</code>
        </li>
      
        <li class="covered" data-hits="1460" data-linenumber="130">
          <span class="hits">1460</span>
          
          <code class="ruby">        logger.debug &amp;block</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">      def fulfill_probe_orders</code>
        </li>
      
        <li class="covered" data-hits="744" data-linenumber="134">
          <span class="hits">744</span>
          
          <code class="ruby">        log{{:probes_for =&gt; @const.name, :type =&gt; self.class}}</code>
        </li>
      
        <li class="covered" data-hits="372" data-linenumber="135">
          <span class="hits">372</span>
          
          <code class="ruby">        @probe_orders.each do |method_name|</code>
        </li>
      
        <li class="covered" data-hits="1032" data-linenumber="136">
          <span class="hits">1032</span>
          
          <code class="ruby">          log{{ :method =&gt; method_name }}</code>
        </li>
      
        <li class="covered" data-hits="516" data-linenumber="137">
          <span class="hits">516</span>
          
          <code class="ruby">          build_tracing_wrappers(@const, method_name)</code>
        </li>
      
        <li class="covered" data-hits="516" data-linenumber="138">
          <span class="hits">516</span>
          
          <code class="ruby">          descendants_that_define(method_name).each do |klass|</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="139">
          <span class="hits">44</span>
          
          <code class="ruby">            log{{ :subclass =&gt; klass.name }}</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="140">
          <span class="hits">22</span>
          
          <code class="ruby">            build_tracing_wrappers(klass, method_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="372" data-linenumber="143">
          <span class="hits">372</span>
          
          <code class="ruby">        @probe_orders.clear</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">      def get_method(klass, method_name)</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="147">
          <span class="hits">22</span>
          
          <code class="ruby">        klass.instance_method(method_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">      def define_trace_method(target, method)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="151">
          <span class="hits">3</span>
          
          <code class="ruby">        target.class_exec() do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="152">
          <span class="hits">3</span>
          
          <code class="ruby">          define_method(method.name) do |*args, &amp;block|</code>
        </li>
      
        <li class="covered" data-hits="69" data-linenumber="153">
          <span class="hits">69</span>
          
          <code class="ruby">            ProbeRunner::probe_run(self, method.owner.name, :instance, args, caller(0)[0], method.name) do</code>
        </li>
      
        <li class="covered" data-hits="69" data-linenumber="154">
          <span class="hits">69</span>
          
          <code class="ruby">              method.bind(self).call(*args, &amp;block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">      def build_tracing_wrappers(target, method_name)</code>
        </li>
      
        <li class="covered" data-hits="538" data-linenumber="161">
          <span class="hits">538</span>
          
          <code class="ruby">        return if @probed.has_key?([target,method_name])</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="162">
          <span class="hits">34</span>
          
          <code class="ruby">        @probed[[target,method_name]] = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="164">
          <span class="hits">34</span>
          
          <code class="ruby">        meth = get_method(target, method_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="166">
          <span class="hits">16</span>
          
          <code class="ruby">        log{ {:tracing =&gt; meth } }</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="167">
          <span class="hits">8</span>
          
          <code class="ruby">        define_trace_method(target, meth)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">      rescue NameError =&gt; ne</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="169">
          <span class="hits">52</span>
          
          <code class="ruby">        log{ {:not_tracing =&gt; NameError } }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">    class ClassProbe &lt; Probe</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">      def local_method_defs(klass)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="175">
          <span class="hits">33</span>
          
          <code class="ruby">        klass.singleton_methods(false)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">      def get_method(klass, method_name)</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="179">
          <span class="hits">24</span>
          
          <code class="ruby">        (class &lt;&lt; klass; self; end).instance_method(method_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">      def define_trace_method(target, method)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="183">
          <span class="hits">10</span>
          
          <code class="ruby">        (class &lt;&lt; target; self; end).class_exec() do</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="184">
          <span class="hits">5</span>
          
          <code class="ruby">          define_method(method.name) do |*args, &amp;block|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="185">
          <span class="hits">9</span>
          
          <code class="ruby">          ProbeRunner::probe_run(self, target.name, :class, args, caller(0)[0], method.name) do</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="186">
          <span class="hits">9</span>
          
          <code class="ruby">            method.bind(self).call(*args, &amp;block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">    class InstanceProbe &lt; Probe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ad42fe0d6cac46cb6edea2edb02be543f8298887">
  <div class="header">
    <h3>lib/insight/instrumentation/setup.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>20</b> relevant lines. 
      <span class="green"><b>20</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight::Instrumentation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Setup</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="97" data-linenumber="4">
          <span class="hits">97</span>
          
          <code class="ruby">      @app = app</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    def setup(env)</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="8">
          <span class="hits">76</span>
          
          <code class="ruby">      instrument = Instrument.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="10">
          <span class="hits">76</span>
          
          <code class="ruby">      PackageDefinition.start</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="11">
          <span class="hits">76</span>
          
          <code class="ruby">      instrument.start(env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="13">
          <span class="hits">76</span>
          
          <code class="ruby">      env[&quot;insight.instrument&quot;] = instrument</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="14">
          <span class="hits">76</span>
          
          <code class="ruby">      Thread::current[&quot;insight.instrument&quot;] = instrument</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def teardown(env, status, headers, body)</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="18">
          <span class="hits">76</span>
          
          <code class="ruby">      instrument, env[&quot;insight.instrument&quot;] = env[&quot;insight.instrument&quot;], nil</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="19">
          <span class="hits">76</span>
          
          <code class="ruby">      instrument.finish(env, status, headers, body)</code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="20">
          <span class="hits">76</span>
          
          <code class="ruby">      Thread::current[&quot;insight.instrument&quot;] = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="76" data-linenumber="22">
          <span class="hits">76</span>
          
          <code class="ruby">      env[&quot;insight.duration&quot;] = instrument.duration</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    def call(env)</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="26">
          <span class="hits">65</span>
          
          <code class="ruby">      setup(env)</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="27">
          <span class="hits">65</span>
          
          <code class="ruby">      status, headers, body = @app.call(env)</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="28">
          <span class="hits">65</span>
          
          <code class="ruby">      teardown(env, status, headers, body)</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="29">
          <span class="hits">65</span>
          
          <code class="ruby">      return [status, headers, body]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4829be6d9801e141549822c7a7c80687d8bd3725">
  <div class="header">
    <h3>lib/insight/logger.rb</h3>
    <h4><span class="green">97.06 %</span> covered</h4>
    <div>
      <b>34</b> relevant lines. 
      <span class="green"><b>33</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Logger</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(level, path)</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="4">
          <span class="hits">85</span>
          
          <code class="ruby">      @level = level</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="5">
          <span class="hits">85</span>
          
          <code class="ruby">      @log_path = path</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="6">
          <span class="hits">85</span>
          
          <code class="ruby">      @logfile = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :level</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    DEBUG    =  0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    INFO     =  1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    WARN     =  2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    ERROR    =  3</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    FATAL    =  4</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    UNKNOWN  =  5</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    def log(severity, message)</code>
        </li>
      
        <li class="covered" data-hits="7051" data-linenumber="19">
          <span class="hits">7051</span>
          
          <code class="ruby">      message = message.inspect unless String === message</code>
        </li>
      
        <li class="covered" data-hits="7051" data-linenumber="20">
          <span class="hits">7051</span>
          
          <code class="ruby">      return unless severity &gt;= @level</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1582" data-linenumber="22">
          <span class="hits">1582</span>
          
          <code class="ruby">      if defined? Rails and Rails.respond_to?(:logger) and not Rails.logger.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">        Rails.logger.add(severity, &quot;[Insight]: &quot; + message)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1582" data-linenumber="26">
          <span class="hits">1582</span>
          
          <code class="ruby">      logfile.puts(message)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    def logfile</code>
        </li>
      
        <li class="covered" data-hits="1582" data-linenumber="30">
          <span class="hits">1582</span>
          
          <code class="ruby">      @logfile ||= File::open(@log_path, &quot;a+&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    rescue</code>
        </li>
      
        <li class="covered" data-hits="198" data-linenumber="32">
          <span class="hits">198</span>
          
          <code class="ruby">      $stderr</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3063" data-linenumber="35">
          <span class="hits">3063</span>
          
          <code class="ruby">    def debug;   log(DEBUG,   yield) end</code>
        </li>
      
        <li class="covered" data-hits="2781" data-linenumber="36">
          <span class="hits">2781</span>
          
          <code class="ruby">    def info;    log(INFO,    yield) end</code>
        </li>
      
        <li class="covered" data-hits="1210" data-linenumber="37">
          <span class="hits">1210</span>
          
          <code class="ruby">    def warn;    log(WARN,    yield) end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    def error;   log(ERROR,   yield) end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def fatal;   log(FATAL,   yield) end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    def unknown; log(UNKNOWN, yield) end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  module Logging</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    def logger(env = nil)</code>
        </li>
      
        <li class="covered" data-hits="6877" data-linenumber="45">
          <span class="hits">6877</span>
          
          <code class="ruby">      if env.nil?</code>
        </li>
      
        <li class="covered" data-hits="6827" data-linenumber="46">
          <span class="hits">6827</span>
          
          <code class="ruby">        Thread.current['insight.logger'] ||= Logger.new(Logger::DEBUG, &quot;&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="48">
          <span class="hits">50</span>
          
          <code class="ruby">        env[&quot;insight.logger&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">    module_function :logger</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="01be41f4857c272c30aca7b3547e11da96800710">
  <div class="header">
    <h3>lib/insight/options.rb</h3>
    <h4><span class="yellow">86.27 %</span> covered</h4>
    <div>
      <b>51</b> relevant lines. 
      <span class="green"><b>44</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'ipaddr'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  module Options</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    class &lt;&lt; self</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">      private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      def option_accessor(key)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="8">
          <span class="hits">6</span>
          
          <code class="ruby">        define_method(key) { || read_option(key) }</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="9">
          <span class="hits">32</span>
          
          <code class="ruby">        define_method(&quot;#{key}=&quot;) { |value| write_option(key, value) }</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="10">
          <span class="hits">6</span>
          
          <code class="ruby">        define_method(&quot;#{key}?&quot;) { || !! read_option(key) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    option_accessor :secret_key</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    option_accessor :ip_masks</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    option_accessor :password</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    option_accessor :panel_classes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    option_accessor :intercept_redirects</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    option_accessor :database_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    # The underlying options Hash. During initialization (or outside of a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    # request), this is a default values Hash. During a request, this is the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    # Rack environment Hash. The default values Hash is merged in underneath</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    # the Rack environment before each request is processed.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    def options</code>
        </li>
      
        <li class="covered" data-hits="253" data-linenumber="26">
          <span class="hits">253</span>
          
          <code class="ruby">      @env || @default_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    # Set multiple options.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    def options=(hash={})</code>
        </li>
      
        <li class="covered" data-hits="1192" data-linenumber="31">
          <span class="hits">1192</span>
          
          <code class="ruby">      hash.each { |key,value| write_option(key, value) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    # Set an option. When +option+ is a Symbol, it is set in the Rack</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    # Environment as &quot;rack-cache.option&quot;. When +option+ is a String, it</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    # exactly as specified. The +option+ argument may also be a Hash in</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    # which case each key/value pair is merged into the environment as if</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    # the #set method were called on each.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def set(option, value=self, &amp;block)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="40">
          
          
          <code class="ruby">      if block_given?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">        write_option option, block</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">      elsif value == self</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">        self.options = option.to_hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">        write_option option, value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">    def read_option(key)</code>
        </li>
      
        <li class="covered" data-hits="432" data-linenumber="52">
          <span class="hits">432</span>
          
          <code class="ruby">      key = option_name(key)</code>
        </li>
      
        <li class="covered" data-hits="432" data-linenumber="53">
          <span class="hits">432</span>
          
          <code class="ruby">      if @env and @env.has_key?(key)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="54">
          
          
          <code class="ruby">        @env[key]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="432" data-linenumber="56">
          <span class="hits">432</span>
          
          <code class="ruby">        @default_options[key]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">    def write_option(key, value)</code>
        </li>
      
        <li class="covered" data-hits="1138" data-linenumber="61">
          <span class="hits">1138</span>
          
          <code class="ruby">      @default_options[option_name(key)] = value</code>
        </li>
      
        <li class="covered" data-hits="1138" data-linenumber="62">
          <span class="hits">1138</span>
          
          <code class="ruby">      if @env.respond_to? :[]</code>
        </li>
      
        <li class="covered" data-hits="962" data-linenumber="63">
          <span class="hits">962</span>
          
          <code class="ruby">        @env[option_name(key)] = value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">    def option_name(key)</code>
        </li>
      
        <li class="covered" data-hits="2532" data-linenumber="68">
          <span class="hits">2532</span>
          
          <code class="ruby">      case key</code>
        </li>
      
        <li class="covered" data-hits="264" data-linenumber="69">
          <span class="hits">264</span>
          
          <code class="ruby">      when Symbol ; &quot;insight.#{key}&quot;</code>
        </li>
      
        <li class="covered" data-hits="2268" data-linenumber="70">
          <span class="hits">2268</span>
          
          <code class="ruby">      when String ; key</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="71">
          
          
          <code class="ruby">      else raise ArgumentError</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">    def process_options</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="76">
          <span class="hits">86</span>
          
          <code class="ruby">      if(file_list = read_option('insight.panel_files'))</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="77">
          <span class="hits">86</span>
          
          <code class="ruby">        class_list = read_option('insight.panel_classes') || []</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="78">
          <span class="hits">86</span>
          
          <code class="ruby">        file_list.each do |file|</code>
        </li>
      
        <li class="covered" data-hits="590" data-linenumber="79">
          <span class="hits">590</span>
          
          <code class="ruby">          class_list |= Insight::Panel.from_file(file)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="81">
          <span class="hits">86</span>
          
          <code class="ruby">        write_option('insight.panel_classes', class_list)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="84">
          <span class="hits">86</span>
          
          <code class="ruby">      Insight::Database.database_path = read_option('insight.database_path')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize_options(options=nil)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="88">
          <span class="hits">86</span>
          
          <code class="ruby">      @default_options = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">        'insight.ip_masks'             =&gt;  [IPAddr.new(&quot;127.0.0.1&quot;)],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">        'insight.password'             =&gt;  nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">        'insight.verbose'              =&gt;  nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">        'insight.secret_key'           =&gt;  nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">        'insight.intercept_redirects'  =&gt;  false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">        'insight.panels'               =&gt;  [],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">        'insight.path_filters'         =&gt;  %w{/assets/},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">        'insight.log_level'            =&gt;  Logger::INFO,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">        'insight.log_path'             =&gt;  &quot;log/insight.log&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">        'insight.database_path'        =&gt;  &quot;insight.sqlite&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">        'insight.panel_files'          =&gt;  %w{</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">          rails_info_panel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">          timer_panel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">          request_variables_panel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">          sql_panel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">          active_record_panel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">          cache_panel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">          templates_panel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">          log_panel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">          memory_panel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="111">
          <span class="hits">86</span>
          
          <code class="ruby">      self.options = options || {}</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="112">
          <span class="hits">86</span>
          
          <code class="ruby">      process_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5a6acdcd4236f51744f626c6e5c549803cf32e18">
  <div class="header">
    <h3>lib/insight/panel.rb</h3>
    <h4><span class="green">95.38 %</span> covered</h4>
    <div>
      <b>65</b> relevant lines. 
      <span class="green"><b>62</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;erb&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/database'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/instrumentation'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/render'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  # Panels are also Rack middleware</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  class Panel</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    include Render</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    include ERB::Util</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    include Database::RequestDataClient</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    include Logging</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    include Instrumentation::Client</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :request</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    class &lt;&lt; self</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      def file_index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">        return @file_index ||= Hash.new do |h,k|</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="21">
          <span class="hits">11</span>
          
          <code class="ruby">          h[k] = []</code>
        </li>
      
        <li class="covered" data-hits="601" data-linenumber="22">
          <span class="hits">601</span>
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">      def panel_exclusion</code>
        </li>
      
        <li class="covered" data-hits="590" data-linenumber="26">
          <span class="hits">590</span>
          
          <code class="ruby">        return @panel_exclusion ||= []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">      def from_file(rel_path)</code>
        </li>
      
        <li class="covered" data-hits="590" data-linenumber="30">
          <span class="hits">590</span>
          
          <code class="ruby">        old_rel, Thread::current['panel_file'] = Thread::current['panel_file'], rel_path</code>
        </li>
      
        <li class="covered" data-hits="590" data-linenumber="31">
          <span class="hits">590</span>
          
          <code class="ruby">        require File::join('insight', 'panels', rel_path)</code>
        </li>
      
        <li class="covered" data-hits="590" data-linenumber="32">
          <span class="hits">590</span>
          
          <code class="ruby">        return (file_index[rel_path] - panel_exclusion)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      ensure</code>
        </li>
      
        <li class="covered" data-hits="590" data-linenumber="34">
          <span class="hits">590</span>
          
          <code class="ruby">        Thread::current['panel_file'] = old_rel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      def current_panel_file</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">        return Thread::current['panel_file'] ||</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">          begin</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">            file_name = nil</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">            caller.each do |line|</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="42">
          <span class="hits">13</span>
          
          <code class="ruby">              md = %r{^[^:]*insight/panels/([^:]*)\.rb:}.match line</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="43">
          <span class="hits">13</span>
          
          <code class="ruby">              unless md.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">                file_name = md[1]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">            file_name</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="48">
          <span class="hits">23</span>
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">      def inherited(sub)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="52">
          <span class="hits">12</span>
          
          <code class="ruby">        if filename = current_panel_file</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="53">
          <span class="hits">11</span>
          
          <code class="ruby">          Panel::file_index[current_panel_file] &lt;&lt; sub</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">          warn &quot;Insight::Panel inherited by #{sub.name} outside of an insight/panels/* file.  Discarded&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">      def excluded(klass = nil)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">        Panel::panel_exclusion &lt;&lt; klass || self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="590" data-linenumber="66">
          <span class="hits">590</span>
          
          <code class="ruby">      if panel_app</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">        #XXX use mappings</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="68">
          <span class="hits">63</span>
          
          <code class="ruby">        @app = Rack::Cascade.new([panel_app, app])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="527" data-linenumber="70">
          <span class="hits">527</span>
          
          <code class="ruby">        @app = app</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">    def call(env)</code>
        </li>
      
        <li class="covered" data-hits="462" data-linenumber="75">
          <span class="hits">462</span>
          
          <code class="ruby">      @env = env</code>
        </li>
      
        <li class="covered" data-hits="924" data-linenumber="76">
          <span class="hits">924</span>
          
          <code class="ruby">      logger.debug{ &quot;Before call: #{self.name}&quot; }</code>
        </li>
      
        <li class="covered" data-hits="462" data-linenumber="77">
          <span class="hits">462</span>
          
          <code class="ruby">      before(env)</code>
        </li>
      
        <li class="covered" data-hits="462" data-linenumber="78">
          <span class="hits">462</span>
          
          <code class="ruby">      status, headers, body = @app.call(env)</code>
        </li>
      
        <li class="covered" data-hits="462" data-linenumber="79">
          <span class="hits">462</span>
          
          <code class="ruby">      @request = Rack::Request.new(env)</code>
        </li>
      
        <li class="covered" data-hits="924" data-linenumber="80">
          <span class="hits">924</span>
          
          <code class="ruby">      logger.debug{ &quot;After call: #{self.name}&quot; }</code>
        </li>
      
        <li class="covered" data-hits="462" data-linenumber="81">
          <span class="hits">462</span>
          
          <code class="ruby">      after(env, status, headers, body)</code>
        </li>
      
        <li class="covered" data-hits="462" data-linenumber="82">
          <span class="hits">462</span>
          
          <code class="ruby">      env[&quot;insight.panels&quot;] &lt;&lt; self</code>
        </li>
      
        <li class="covered" data-hits="462" data-linenumber="83">
          <span class="hits">462</span>
          
          <code class="ruby">      return [status, headers, body]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">    def panel_app</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.panel_mappings</code>
        </li>
      
        <li class="covered" data-hits="514" data-linenumber="91">
          <span class="hits">514</span>
          
          <code class="ruby">      {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">    def has_content?</code>
        </li>
      
        <li class="covered" data-hits="832" data-linenumber="95">
          <span class="hits">832</span>
          
          <code class="ruby">      true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">    def name</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="99">
          
          
          <code class="ruby">      &quot;Unnamed panel: #{self.class.name}&quot; #for shame</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">    def heading_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="159" data-linenumber="103">
          <span class="hits">159</span>
          
          <code class="ruby">      heading rescue &quot;xxx&quot; #XXX: no panel should need this</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">    def content_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="58" data-linenumber="107">
          <span class="hits">58</span>
          
          <code class="ruby">      content rescue &quot;&quot; #XXX: no panel should need this</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">    def before(env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">    def after(env, status, headers, body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">    def render(template)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5a44888c7744d241d7a9526bbd2b865dfe83bfe0">
  <div class="header">
    <h3>lib/insight/panel_app.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  class PanelApp</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Insight::Render</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :request</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def call(env)</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="9">
          <span class="hits">64</span>
          
          <code class="ruby">      @request = Rack::Request.new(env)</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="10">
          <span class="hits">64</span>
          
          <code class="ruby">      dispatch</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    def render_template(*args)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="14">
          <span class="hits">4</span>
          
          <code class="ruby">      Rack::Response.new([super]).to_a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def params</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="18">
          <span class="hits">12</span>
          
          <code class="ruby">      @request.GET</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    def not_found(message=&quot;&quot;)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="22">
          <span class="hits">50</span>
          
          <code class="ruby">      [404, {}, [message]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate_params</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="26">
          <span class="hits">14</span>
          
          <code class="ruby">      ParamsSignature.new(request).validate!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2cd4a0a8402bbecc0e258ff7ef1ced5132c42383">
  <div class="header">
    <h3>lib/insight/panels-content.rb</h3>
    <h4><span class="red">46.15 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class PanelsContent &lt; PanelApp</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(insight_app)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="4">
          <span class="hits">86</span>
          
          <code class="ruby">      @insight_app = insight_app</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="5">
          <span class="hits">86</span>
          
          <code class="ruby">      @request_table = Database::RequestTable.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def dispatch</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      return not_found(&quot;not get&quot;) unless @request.get?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">      return not_found(&quot;id nil&quot;) if params['request_id'].nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      request = @request_table.select(&quot;*&quot;, &quot;id = #{params['request_id']}&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      return not_found(&quot;id not found&quot;) if request.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      requests = @request_table.to_a.map do |row|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">        { :id =&gt; row[0], :method =&gt; row[1], :path =&gt; row[2] }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      render_template(&quot;request_fragment&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">                      :request_id =&gt; params['request_id'].to_i,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">                      :requests =&gt; requests,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">                      :panels =&gt; @insight_app.panels)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a31faff1d0f3f943a31af37b779d0c0cf09bd62c">
  <div class="header">
    <h3>lib/insight/panels-header.rb</h3>
    <h4><span class="red">54.55 %</span> covered</h4>
    <div>
      <b>11</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class PanelsHeader &lt; PanelApp</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(insight_app)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="4">
          <span class="hits">86</span>
          
          <code class="ruby">      @insight_app = insight_app</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="5">
          <span class="hits">86</span>
          
          <code class="ruby">      @request_table = Database::RequestTable.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def dispatch</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      return not_found(&quot;not get&quot;) unless @request.get?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">      return not_found(&quot;id nil&quot;) if params['request_id'].nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      request = @request_table.select(&quot;*&quot;, &quot;id = #{params['request_id']}&quot;).first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      return not_found(&quot;id not found&quot;) if request.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">      render_template(&quot;headers_fragment&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">                      :request_id =&gt; params['request_id'].to_i,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">                      :panels =&gt; @insight_app.panels)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="dbfdccfe7e98985801ebd71866db06d6dc3bb235">
  <div class="header">
    <h3>lib/insight/panels/active_record_panel.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class ActiveRecordPanel &lt; Panel</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="4">
          <span class="hits">65</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="6">
          <span class="hits">65</span>
          
          <code class="ruby">      table_setup(&quot;active_record&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="8">
          <span class="hits">65</span>
          
          <code class="ruby">      probe(self) do</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="9">
          <span class="hits">65</span>
          
          <code class="ruby">        instrument &quot;ActiveRecord::Base&quot; do</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="10">
          <span class="hits">65</span>
          
          <code class="ruby">          class_probe :allocate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    def request_start(env, start)</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="16">
          <span class="hits">56</span>
          
          <code class="ruby">      @records = Hash.new{ 0 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    def after_detect(method_call, timing, results, args)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="20">
          <span class="hits">5</span>
          
          <code class="ruby">      @records[method_call.object.base_class.name] += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    def request_finish(env, status, headers, body, timing)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="24">
          <span class="hits">52</span>
          
          <code class="ruby">      store(env, @records)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    def name</code>
        </li>
      
        <li class="covered" data-hits="226" data-linenumber="28">
          <span class="hits">226</span>
          
          <code class="ruby">      &quot;active_record&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    def heading_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="32">
          <span class="hits">52</span>
          
          <code class="ruby">      record = retrieve(number).first</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="33">
          <span class="hits">52</span>
          
          <code class="ruby">      total = record.inject(0) do |memo, (key, value)|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="34">
          <span class="hits">4</span>
          
          <code class="ruby">        memo + value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="46" data-linenumber="36">
          <span class="hits">46</span>
          
          <code class="ruby">      &quot;#{total} AR Objects&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    def content_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="40">
          <span class="hits">56</span>
          
          <code class="ruby">      records = retreive(number).first.to_a.sort_by { |key, value| value }.reverse</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="41">
          <span class="hits">52</span>
          
          <code class="ruby">      render_template &quot;panels/active_record&quot;, :records =&gt; records</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="6bfeccd6ad7300157d3c6aa071bf36a19a715799">
  <div class="header">
    <h3>lib/insight/panels/cache_panel.rb</h3>
    <h4><span class="green">97.22 %</span> covered</h4>
    <div>
      <b>36</b> relevant lines. 
      <span class="green"><b>35</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  class CachePanel &lt; Panel</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    require &quot;insight/panels/cache_panel/panel_app&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    require &quot;insight/panels/cache_panel/stats&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="9">
          <span class="hits">63</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="11">
          <span class="hits">63</span>
          
          <code class="ruby">      probe(self) do</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="12">
          <span class="hits">63</span>
          
          <code class="ruby">        instrument(&quot;Memcached&quot;) do</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="13">
          <span class="hits">63</span>
          
          <code class="ruby">          instance_probe :decrement, :get, :increment, :set, :add,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">            :replace, :delete, :prepend, :append</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="17">
          <span class="hits">63</span>
          
          <code class="ruby">        instrument(&quot;MemCache&quot;) do</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="18">
          <span class="hits">63</span>
          
          <code class="ruby">          instance_probe :decr, :get, :get_multi, :incr, :set, :add, :delete</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="21">
          <span class="hits">63</span>
          
          <code class="ruby">        instrument(&quot;Dalli::Client&quot;) do</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="22">
          <span class="hits">63</span>
          
          <code class="ruby">          instance_probe :perform</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="26">
          <span class="hits">63</span>
          
          <code class="ruby">      table_setup(&quot;cache&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    def request_start(env, start)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="30">
          <span class="hits">50</span>
          
          <code class="ruby">      @stats = Stats.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    def request_finish(env, st, hd, bd, timing)</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="34">
          <span class="hits">100</span>
          
          <code class="ruby">      logger(env).debug{ &quot;Stats: #@stats&quot; }</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="35">
          <span class="hits">50</span>
          
          <code class="ruby">      store(env, @stats)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    def after_detect(method_call, timing, args, result)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="39">
          <span class="hits">10</span>
          
          <code class="ruby">      method, key = method_call.method, args.first</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="40">
          <span class="hits">10</span>
          
          <code class="ruby">      if(defined? Dalli and Dalli::Client === method_call.object)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">        method, key = args[0], args[1]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="43">
          <span class="hits">20</span>
          
          <code class="ruby">      logger.info{ &quot;Cache panel got #{method} #{key.inspect}&quot; }</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="44">
          <span class="hits">10</span>
          
          <code class="ruby">      @stats.record_call(method, timing.duration, !result.nil?, key)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def panel_app</code>
        </li>
      
        <li class="covered" data-hits="126" data-linenumber="48">
          <span class="hits">126</span>
          
          <code class="ruby">      PanelApp.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">    def name</code>
        </li>
      
        <li class="covered" data-hits="218" data-linenumber="52">
          <span class="hits">218</span>
          
          <code class="ruby">      &quot;cache&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">    def heading_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="56">
          <span class="hits">50</span>
          
          <code class="ruby">      stats = retreive(number).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="58">
          <span class="hits">50</span>
          
          <code class="ruby">      &quot;Cache: %.2fms (#{stats.queries.size} calls)&quot; % stats.time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">    def content_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="62">
          <span class="hits">100</span>
          
          <code class="ruby">      logger.debug{{ :req_num =&gt; number }}</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="63">
          <span class="hits">50</span>
          
          <code class="ruby">      stats = retreive(number).first</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="64">
          <span class="hits">50</span>
          
          <code class="ruby">      render_template &quot;panels/cache&quot;, :stats =&gt; stats</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7e8393d819634626092248a648eca59b55952d34">
  <div class="header">
    <h3>lib/insight/panels/cache_panel/panel_app.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>26</b> relevant lines. 
      <span class="green"><b>26</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class CachePanel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    class PanelApp &lt; ::Insight::PanelApp</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">      def dispatch</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="7">
          <span class="hits">56</span>
          
          <code class="ruby">        case request.path_info</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="8">
          <span class="hits">2</span>
          
          <code class="ruby">        when &quot;/__insight__/view_cache&quot;         then view_cache</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="9">
          <span class="hits">2</span>
          
          <code class="ruby">        when &quot;/__insight__/delete_cache&quot;       then delete_cache</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="10">
          <span class="hits">2</span>
          
          <code class="ruby">        when &quot;/__insight__/delete_cache_list&quot;  then delete_cache_list</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="11">
          <span class="hits">50</span>
          
          <code class="ruby">        else not_found</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      def ok</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="16">
          <span class="hits">4</span>
          
          <code class="ruby">        Rack::Response.new([&quot;OK&quot;]).to_a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      def view_cache</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="20">
          <span class="hits">2</span>
          
          <code class="ruby">        validate_params</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="21">
          <span class="hits">2</span>
          
          <code class="ruby">        render_template &quot;panels/view_cache&quot;, :key =&gt; params[&quot;key&quot;], :value =&gt; Rails.cache.read(params[&quot;key&quot;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      def delete_cache</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">        validate_params</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="26">
          <span class="hits">2</span>
          
          <code class="ruby">        raise &quot;Rails not found... can't delete key&quot; unless defined?(Rails)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="27">
          <span class="hits">2</span>
          
          <code class="ruby">        Rails.cache.delete(params[&quot;key&quot;])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="28">
          <span class="hits">2</span>
          
          <code class="ruby">        ok</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">      def delete_cache_list</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="32">
          <span class="hits">2</span>
          
          <code class="ruby">        validate_params</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="33">
          <span class="hits">2</span>
          
          <code class="ruby">        raise &quot;Rails not found... can't delete key&quot; unless defined?(Rails)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="35">
          <span class="hits">2</span>
          
          <code class="ruby">        params.each do |key, value|</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="36">
          <span class="hits">10</span>
          
          <code class="ruby">          next unless key =~ /^keys_/</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="37">
          <span class="hits">8</span>
          
          <code class="ruby">            Rails.cache.delete(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="40">
          <span class="hits">2</span>
          
          <code class="ruby">        ok</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3b98fa9292bb23d0d7bfb56d7b304e587a9e83fd">
  <div class="header">
    <h3>lib/insight/panels/cache_panel/stats.rb</h3>
    <h4><span class="green">96.36 %</span> covered</h4>
    <div>
      <b>55</b> relevant lines. 
      <span class="green"><b>53</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class CachePanel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    class Stats</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">      class Query</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">        attr_reader :method, :time, :hit, :keys</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">        def initialize(method, time, hit, keys)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="9">
          <span class="hits">10</span>
          
          <code class="ruby">          @method = method</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="10">
          <span class="hits">10</span>
          
          <code class="ruby">          @time = time</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="11">
          <span class="hits">10</span>
          
          <code class="ruby">          @hit = hit</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="12">
          <span class="hits">10</span>
          
          <code class="ruby">          @keys = keys</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">        def display_time</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="16">
          <span class="hits">10</span>
          
          <code class="ruby">          &quot;%.2fms&quot; % time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">        def display_keys</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="20">
          <span class="hits">10</span>
          
          <code class="ruby">          if keys.size == 1</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="21">
          <span class="hits">10</span>
          
          <code class="ruby">            keys.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">            keys.join(&quot;, &quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :calls</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :keys</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :queries</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="33">
          <span class="hits">50</span>
          
          <code class="ruby">        @queries = []</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="34">
          <span class="hits">50</span>
          
          <code class="ruby">        @misses =</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">          @calls = 0</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="36">
          <span class="hits">50</span>
          
          <code class="ruby">        @time = 0.0</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="37">
          <span class="hits">50</span>
          
          <code class="ruby">        @keys = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">      def record_call(method, time, hit, key)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="41">
          <span class="hits">10</span>
          
          <code class="ruby">        if Array === key</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">          @queries &lt;&lt; Query.new(:get_multi, time, hit, key)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="44">
          <span class="hits">10</span>
          
          <code class="ruby">          @queries &lt;&lt; Query.new(method.to_sym, time, hit, [key])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="46">
          <span class="hits">10</span>
          
          <code class="ruby">        @calls += 1</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="47">
          <span class="hits">10</span>
          
          <code class="ruby">        @time += time</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="48">
          <span class="hits">10</span>
          
          <code class="ruby">        @keys += keys</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">      def display_time</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="52">
          <span class="hits">44</span>
          
          <code class="ruby">        &quot;%.2fms&quot; % time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">      def time</code>
        </li>
      
        <li class="covered" data-hits="88" data-linenumber="56">
          <span class="hits">88</span>
          
          <code class="ruby">        @queries.inject(0) do |memo, query|</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="57">
          <span class="hits">20</span>
          
          <code class="ruby">          memo + query.time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">      def gets</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="62">
          <span class="hits">44</span>
          
          <code class="ruby">        count_queries(:get)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">      def sets</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="66">
          <span class="hits">44</span>
          
          <code class="ruby">        count_queries(:set)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">      def deletes</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="70">
          <span class="hits">44</span>
          
          <code class="ruby">        count_queries(:delete)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">      def get_multis</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="74">
          <span class="hits">44</span>
          
          <code class="ruby">        count_queries(:get_multi)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">      def hits</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="78">
          <span class="hits">54</span>
          
          <code class="ruby">        @queries.select { |q| [:get, :get_multi].include?(q.method) &amp;&amp; q.hit }.size</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">      def misses</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="82">
          <span class="hits">54</span>
          
          <code class="ruby">        @queries.select { |q| [:get, :get_multi].include?(q.method) &amp;&amp; !q.hit }.size</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">      def count_queries(method)</code>
        </li>
      
        <li class="covered" data-hits="216" data-linenumber="86">
          <span class="hits">216</span>
          
          <code class="ruby">        @queries.select { |q| q.method == method }.size</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">      def queries_to_param</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="90">
          <span class="hits">10</span>
          
          <code class="ruby">        params = {}</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="91">
          <span class="hits">10</span>
          
          <code class="ruby">        @queries.each_with_index do |query, index|</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="92">
          <span class="hits">10</span>
          
          <code class="ruby">          params[&quot;keys_#{index}&quot;] = query.keys.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="94">
          <span class="hits">10</span>
          
          <code class="ruby">        params</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9c428b30089b69e84746a9ac0090a1b2e5b87a89">
  <div class="header">
    <h3>lib/insight/panels/log_panel.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>29</b> relevant lines. 
      <span class="green"><b>29</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class LogPanel &lt; Panel</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class LogEntry</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :level, :time, :message</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">      LEVELS = ['DEBUG', 'INFO', 'WARN', 'ERROR', 'FATAL']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(level, time, message)</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="8">
          <span class="hits">18</span>
          
          <code class="ruby">        @level = LEVELS[level]</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="9">
          <span class="hits">18</span>
          
          <code class="ruby">        @time = time</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="10">
          <span class="hits">18</span>
          
          <code class="ruby">        @message = message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">      def cleaned_message</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="14">
          <span class="hits">18</span>
          
          <code class="ruby">        @message.to_s.gsub(/\e\[[;\d]+m/, &quot;&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    def after_detect(method_call, timing, args, message)</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="19">
          <span class="hits">18</span>
          
          <code class="ruby">      message = args[1] || args[2] unless message.is_a?(String)</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="20">
          <span class="hits">18</span>
          
          <code class="ruby">      log_level = args[0]</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="21">
          <span class="hits">18</span>
          
          <code class="ruby">      store(@env, LogEntry.new(log_level, timing.delta_t, message))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="25">
          <span class="hits">18</span>
          
          <code class="ruby">      probe(self) do</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="26">
          <span class="hits">18</span>
          
          <code class="ruby">        instrument &quot;ActiveSupport::BufferedLogger&quot; do</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="27">
          <span class="hits">18</span>
          
          <code class="ruby">          instance_probe :add</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="30">
          <span class="hits">18</span>
          
          <code class="ruby">        instrument &quot;Logger&quot; do</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="31">
          <span class="hits">18</span>
          
          <code class="ruby">          instance_probe :add</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="35">
          <span class="hits">18</span>
          
          <code class="ruby">      table_setup(&quot;log_entries&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="37">
          <span class="hits">18</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    def name</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="41">
          <span class="hits">96</span>
          
          <code class="ruby">      &quot;log&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    def heading</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="45">
          <span class="hits">24</span>
          
          <code class="ruby">      &quot;Log&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">    def content_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="49">
          <span class="hits">24</span>
          
          <code class="ruby">      render_template &quot;panels/log&quot;, :logs =&gt; retrieve(number)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3704f646b348bb4a80d31e153567d3bb834452c1">
  <div class="header">
    <h3>lib/insight/panels/memory_panel.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>17</b> relevant lines. 
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  class MemoryPanel &lt; Panel</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="5">
          <span class="hits">63</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="6">
          <span class="hits">63</span>
          
          <code class="ruby">      table_setup(&quot;memory_records&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def before(env)</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="10">
          <span class="hits">56</span>
          
          <code class="ruby">      @original_memory = `ps -o rss= -p #{$$}`.to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    def after(env, status, headers, body)</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="14">
          <span class="hits">56</span>
          
          <code class="ruby">      total_memory = `ps -o rss= -p #{$$}`.to_i</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="15">
          <span class="hits">56</span>
          
          <code class="ruby">      store(env, {:total_memory =&gt; total_memory,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">            :memory_increase =&gt; total_memory - @original_memory,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">            :original_memory =&gt; @original_memory})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def heading_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="21">
          <span class="hits">50</span>
          
          <code class="ruby">      record = retrieve(number).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="23">
          <span class="hits">50</span>
          
          <code class="ruby">      &quot;#{record[:memory_increase]} KB &amp;#916;, #{record[:total_memory]} KB total&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    def has_content?</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="27">
          <span class="hits">100</span>
          
          <code class="ruby">      false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    def name</code>
        </li>
      
        <li class="covered" data-hits="112" data-linenumber="31">
          <span class="hits">112</span>
          
          <code class="ruby">      &quot;Memory&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="14c40a96e85934dadd57a940af3dfe299ff465ec">
  <div class="header">
    <h3>lib/insight/panels/rails_info_panel.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class RailsInfoPanel &lt; Panel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    def name</code>
        </li>
      
        <li class="covered" data-hits="212" data-linenumber="5">
          <span class="hits">212</span>
          
          <code class="ruby">      &quot;rails_info&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def heading</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="9">
          <span class="hits">50</span>
          
          <code class="ruby">      return unless (defined?(Rails) &amp;&amp; defined?(Rails::Info))</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="10">
          <span class="hits">2</span>
          
          <code class="ruby">      &quot;Rails #{Rails.version}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    def content</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="14">
          <span class="hits">50</span>
          
          <code class="ruby">      return unless (defined?(Rails) &amp;&amp; defined?(Rails::Info))</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="15">
          <span class="hits">2</span>
          
          <code class="ruby">      render_template &quot;panels/rails_info&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a6183df34cb20f3872644b6fbb59d8c9aabb21e7">
  <div class="header">
    <h3>lib/insight/panels/redis_panel.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  class RedisPanel &lt; Panel</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    require &quot;insight/panels/redis_panel/redis_extension&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    require &quot;insight/panels/redis_panel/stats&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.record(redis_command_args, backtrace, &amp;block)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="9">
          <span class="hits">6</span>
          
          <code class="ruby">      return block.call unless Insight.enabled?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="11">
          <span class="hits">6</span>
          
          <code class="ruby">      start_time = Time.now</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="12">
          <span class="hits">6</span>
          
          <code class="ruby">      result = block.call</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="13">
          <span class="hits">6</span>
          
          <code class="ruby">      total_time = Time.now - start_time</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="14">
          <span class="hits">6</span>
          
          <code class="ruby">      stats.record_call(total_time * 1_000, redis_command_args, backtrace)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="15">
          <span class="hits">6</span>
          
          <code class="ruby">      return result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.reset</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="19">
          <span class="hits">8</span>
          
          <code class="ruby">      Thread.current[&quot;insight.redis&quot;] = Stats.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.stats</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="23">
          <span class="hits">30</span>
          
          <code class="ruby">      Thread.current[&quot;insight.redis&quot;] ||= Stats.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    def name</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="27">
          <span class="hits">32</span>
          
          <code class="ruby">      &quot;redis&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    def heading</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="31">
          <span class="hits">8</span>
          
          <code class="ruby">      &quot;Redis: %.2fms (#{self.class.stats.queries.size} calls)&quot; % self.class.stats.time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    def content</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="35">
          <span class="hits">8</span>
          
          <code class="ruby">      result = render_template &quot;panels/redis&quot;, :stats =&gt; self.class.stats</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="36">
          <span class="hits">8</span>
          
          <code class="ruby">      self.class.reset</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="37">
          <span class="hits">8</span>
          
          <code class="ruby">      return result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0a87b1baa05c3170e9c45a6d80cc9dc3416f8e97">
  <div class="header">
    <h3>lib/insight/panels/redis_panel/redis_extension.rb</h3>
    <h4><span class="red">10.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">if defined?(Redis)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  Redis.class_eval do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">    if Redis.methods.include?('call_command') # older versions of redis-rb</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">      def call_command_with_insight(*argv)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">        Insight::RedisPanel.record(argv, Kernel.caller) do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="6">
          
          
          <code class="ruby">          call_command_without_insight(*argv)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">      alias_method_chain :call_command, :insight</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    elsif defined?(Redis::Client) # newer versions of redis-rb</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">      Redis::Client.class_eval do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="15">
          
          
          <code class="ruby">        def call_with_insight(*argv)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">      alias_method_chain :call, :insight</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8b84834288c901ee5a69413e9fdee7a4d7a342a4">
  <div class="header">
    <h3>lib/insight/panels/redis_panel/stats.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>28</b> relevant lines. 
      <span class="green"><b>28</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class RedisPanel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    class Stats</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">      class Query</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">        include Insight::FilteredBacktrace</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">        attr_reader :time</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">        attr_reader :command</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">        def initialize(time, command_args, backtrace)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="12">
          <span class="hits">6</span>
          
          <code class="ruby">          @time = time</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="13">
          <span class="hits">6</span>
          
          <code class="ruby">          @command = command_args.inspect</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="14">
          <span class="hits">6</span>
          
          <code class="ruby">          @backtrace = backtrace</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">        def display_time</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="18">
          <span class="hits">6</span>
          
          <code class="ruby">          &quot;%.2fms&quot; % time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :calls</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :queries</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="26">
          <span class="hits">9</span>
          
          <code class="ruby">        @queries = []</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="27">
          <span class="hits">9</span>
          
          <code class="ruby">        @calls = 0</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="28">
          <span class="hits">9</span>
          
          <code class="ruby">        @time = 0.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">      def record_call(time, command_args, backtrace)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="32">
          <span class="hits">6</span>
          
          <code class="ruby">        @queries &lt;&lt; Query.new(time, command_args, backtrace)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="33">
          <span class="hits">6</span>
          
          <code class="ruby">        @calls += 1</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="34">
          <span class="hits">6</span>
          
          <code class="ruby">        @time += time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">      def display_time</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="38">
          <span class="hits">8</span>
          
          <code class="ruby">        &quot;%.2fms&quot; % time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">      def time</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="42">
          <span class="hits">16</span>
          
          <code class="ruby">        @queries.inject(0) do |memo, query|</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="43">
          <span class="hits">12</span>
          
          <code class="ruby">          memo + query.time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3bf1de99b86f43309182b62125590148c5f3fa75">
  <div class="header">
    <h3>lib/insight/panels/request_variables_panel.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>37</b> relevant lines. 
      <span class="green"><b>37</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class RequestVariablesPanel &lt; Panel</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="4">
          <span class="hits">63</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="6">
          <span class="hits">63</span>
          
          <code class="ruby">      table_setup(&quot;request_variables&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def name</code>
        </li>
      
        <li class="covered" data-hits="212" data-linenumber="10">
          <span class="hits">212</span>
          
          <code class="ruby">      &quot;request_variables&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    def after(env,status,headers,body)</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="14">
          <span class="hits">56</span>
          
          <code class="ruby">      sections = {}</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="15">
          <span class="hits">56</span>
          
          <code class="ruby">      sections[&quot;GET&quot;] = sort(@request.GET) if @request.GET.any?</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="16">
          <span class="hits">56</span>
          
          <code class="ruby">      sections[&quot;POST&quot;] = sort(@request.POST) if @request.POST.any?</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="17">
          <span class="hits">56</span>
          
          <code class="ruby">      sections[&quot;Session&quot;] = sort(@request.env[&quot;rack.session&quot;]) if @request.env[&quot;rack.session&quot;] &amp;&amp; @request.env[&quot;rack.session&quot;].any?</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="18">
          <span class="hits">56</span>
          
          <code class="ruby">      sections[&quot;Cookies&quot;] = sort(@request.env[&quot;rack.request.cookie_hash&quot;]) if @request.env[&quot;rack.request.cookie_hash&quot;] &amp;&amp; @request.env[&quot;rack.request.cookie_hash&quot;].any?</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="19">
          <span class="hits">56</span>
          
          <code class="ruby">      server, rack = split_and_filter_env(@env)</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="20">
          <span class="hits">56</span>
          
          <code class="ruby">      sections[&quot;SERVER VARIABLES&quot;] = sort(server)</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="21">
          <span class="hits">56</span>
          
          <code class="ruby">      sections[&quot;Rack ENV&quot;] = sort(rack)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">#      require 'pp'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">#      ::File.open(&quot;sections.dump&quot;, &quot;w&quot;) do |file|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">#        PP.pp(sections, file)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">#      end</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="27">
          <span class="hits">56</span>
          
          <code class="ruby">      store(env, sections)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    def heading</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="31">
          <span class="hits">50</span>
          
          <code class="ruby">      &quot;Rack Env&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    def content_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="35">
          <span class="hits">50</span>
          
          <code class="ruby">      sections = retrieve(number).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="37">
          <span class="hits">50</span>
          
          <code class="ruby">      render_template &quot;panels/request_variables&quot;, :sections =&gt; sections</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">    def sort(hash)</code>
        </li>
      
        <li class="covered" data-hits="1601" data-linenumber="42">
          <span class="hits">1601</span>
          
          <code class="ruby">      scrub(hash.sort_by { |k, v| k.to_s })</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    def scrub(enum)</code>
        </li>
      
        <li class="covered" data-hits="177" data-linenumber="46">
          <span class="hits">177</span>
          
          <code class="ruby">      enum.map do |k,v|</code>
        </li>
      
        <li class="covered" data-hits="1424" data-linenumber="47">
          <span class="hits">1424</span>
          
          <code class="ruby">        if Hash === v</code>
        </li>
      
        <li class="covered" data-hits="112" data-linenumber="48">
          <span class="hits">112</span>
          
          <code class="ruby">          [k, v.inspect]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="1312" data-linenumber="50">
          <span class="hits">1312</span>
          
          <code class="ruby">          [k, v.to_s]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">    def split_and_filter_env(env)</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="56">
          <span class="hits">56</span>
          
          <code class="ruby">      server, rack = {}, {}</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="57">
          <span class="hits">56</span>
          
          <code class="ruby">      env.each do |k,v|</code>
        </li>
      
        <li class="covered" data-hits="2232" data-linenumber="58">
          <span class="hits">2232</span>
          
          <code class="ruby">        if k.index(&quot;rack.&quot;) == 0</code>
        </li>
      
        <li class="covered" data-hits="728" data-linenumber="59">
          <span class="hits">728</span>
          
          <code class="ruby">          rack[k] = v</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">        elsif k.index(&quot;insight&quot;) == 0 or k.index(&quot;insight&quot;) == 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">          #don't output the insight variables - especially secret_key</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="618" data-linenumber="63">
          <span class="hits">618</span>
          
          <code class="ruby">          server[k] = v</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="66">
          <span class="hits">56</span>
          
          <code class="ruby">      return server, rack</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="99e761c7ba5745091438f4a5d4e401b51b89aa39">
  <div class="header">
    <h3>lib/insight/panels/speedtracer_panel.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>50</b> relevant lines. 
      <span class="green"><b>50</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">begin</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  require 'yajl'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">rescue LoadError</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  #Means no Chrome Speedtracer...</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">require 'uuid'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/panels/speedtracer_panel/trace-app'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/panels/speedtracer_panel/tracer'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  module SpeedTracer</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    class Panel &lt; ::Insight::Panel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      @app = app</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">      @uuid = UUID.new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">      table_setup(&quot;speedtracer&quot;, &quot;uuid&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">      key_sql_template(&quot;'%s'&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">      @tracer = Tracer.new(@table)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      probe(@tracer) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">        instrument(&quot;ActiveSupport::Notifications&quot;) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">          class_probe :instrument</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">        instrument(&quot;ActionView::Rendering&quot;) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">          instance_probe :render</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">        instrument(&quot;ActionView::Helpers::RecordTagHelper&quot;) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">          instance_probe :content_tag_for</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">        instrument(&quot;ActionView::Partials::PartialRenderer&quot;) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">          instance_probe :render, :find_template, :render_collection, :collection_with_template, :collection_without_template, :partial_path, :collection_paths</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">        instrument(&quot;ActionView::Template&quot;) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">          instance_probe :render, :compile</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">        instrument(&quot;ActiveRecord::Base&quot;) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">          class_probe :find, :find_by_sql, :all, :first, :last, :count, :delete_all</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">          instance_probe :save, :save!, :destroy, :delete</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">        instrument(&quot;ActionController::Base&quot;) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">          instance_probe :process, :render</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">    def call(env)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">      env['insight.speedtracer-id'] = @uuid.generate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">      status, headers, body = @app.call(env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">      store(env, env['insight.speedtracer-id'], env['insight.speedtracer-record'])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">      headers['X-TraceUrl'] = '__insight__/speedtracer?id=' + env['insight.speedtracer-id']</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">      return [status, headers, body]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.panel_mappings</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">      { &quot;speedtracer&quot; =&gt; TraceApp.new }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">    def name</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="71">
          <span class="hits">2</span>
          
          <code class="ruby">      &quot;speedtracer&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">    def heading</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">      &quot;#{table_length} traces&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">    def content_for_request(request_id)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">      trace = retrieve(request_id).first</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">      return &quot;&quot; if trace.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">      advice = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">      if not defined?(Yajl)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">        advice &lt;&lt; &quot;yajl-ruby not installed - Speedtracer server events won't be available&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">      render_template &quot;panels/speedtracer/traces&quot;, :trace =&gt; trace, :advice =&gt; advice</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9601af9428ef52c6f9d20102f5b26296dde0ba9d">
  <div class="header">
    <h3>lib/insight/panels/speedtracer_panel/trace-app.rb</h3>
    <h4><span class="red">52.63 %</span> covered</h4>
    <div>
      <b>19</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module SpeedTracer</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class TraceApp</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">      include Database::RequestDataClient</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">      CONTENT_TYPE = 'application/json;charset=UTF-8'.freeze</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      FourOhFour = [404, {&quot;Content-Type&quot; =&gt; &quot;text/html&quot;}, &quot;App tracker doesn't know that path or id&quot;].freeze</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">        table_setup(&quot;speedtracer&quot;, &quot;uuid&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">        key_sql_template = &quot;'%s'&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      def call(env)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">        resp = Rack::Response.new('', 200)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">        resp['Content-Type'] = CONTENT_TYPE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">        case env['REQUEST_METHOD']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">        when 'HEAD' then</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">          # SpeedTracer dispatches HEAD requests to verify the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">          # tracer endpoint when it detects the X-TraceUrl</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">          # header for the first time. After the initial load</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">          # the verification is cached by the extension.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">          #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">          # By default, we'll return 200.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">        when 'GET' then</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">          # GET requests for specific trace are generated by</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">          # the extension when the user expands the network</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">          # resource tab. Hence, server-side tracer data is</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">          # request on-demand, and we need to store it for</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">          # some time.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">          #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">          qs = Rack::Utils.parse_query(env['QUERY_STRING'])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">          if qs['id'] &amp;&amp; (trace = @table.retrieve(&quot;uuid = '#{qs['id']}'&quot;))</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">            resp.write trace.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">            # Invalid request or missing request trace id</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">            return FourOhFour</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">          # SpeedTracer should only issue GET &amp; HEAD requests</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">          resp.status = 400</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">        return resp.finish</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="27f740fb1d87989d7ff22fa78ab3d4ad8030591d">
  <div class="header">
    <h3>lib/insight/panels/speedtracer_panel/tracer.rb</h3>
    <h4><span class="red">63.92 %</span> covered</h4>
    <div>
      <b>97</b> relevant lines. 
      <span class="green"><b>62</b> lines covered</span> and
      <span class="red"><b>35</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module SpeedTracer</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class Tracer</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(table)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">        @pstack = []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">        @table = table</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">        @event_id = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      def request_start(env, start)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">        id, method, uri = env.values_at(&quot;insight.speedtracer-id&quot;, &quot;REQUEST_METHOD&quot;, &quot;PATH_INFO&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">        @pstack.push RequestRecord.new(id, method, uri)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      def request_finish(env, status, headers, body, timing)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">        env[&quot;insight.speedtracer-record&quot;] = @pstack.pop</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      def before_detect(method_call, arguments)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">        @event_id += 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">        #arguments_string = make_string_of(arguments)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">        arguments_string = &quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">        #XXX ServerEvent use method call...</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">        event = ServerEvent.new(method_call, arguments_string)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">        @pstack.push event</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">      def after_detect(method_call, timing, arguments, result)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">        event = @pstack.pop</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">        if event.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">          event.finish</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="35">
          
          
          <code class="ruby">          unless (parent = @pstack.last).nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="36">
          
          
          <code class="ruby">            parent.children.push event</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="38">
          
          
          <code class="ruby">            @children.push event</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">      def make_string_of(array)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">        array.map do |item|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">          short_string(item)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">        end.join(&quot;,&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">      def short_string(item, max_per_elem = 50)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="51">
          
          
          <code class="ruby">          string = item.inspect</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="52">
          
          
          <code class="ruby">          if string.length &gt; max_per_elem</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="53">
          
          
          <code class="ruby">            case item</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">            when NilClass</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="55">
          
          
          <code class="ruby">              &quot;nil&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">            when Hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">              &quot;{ &quot; + item.map do |key, value|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="58">
          
          
          <code class="ruby">                short_string(key, 15) + &quot;=&gt;&quot; + short_string(value, 30)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">              end.join(&quot;, &quot;) + &quot; }&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">            when find_constant(&quot;ActionView::Base&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="61">
          
          
          <code class="ruby">              tmpl = item.template</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="62">
          
          
          <code class="ruby">              if tmpl.nil?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="63">
          
          
          <code class="ruby">                item.path.inspect</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">              else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="65">
          
          
          <code class="ruby">                [tmpl.base_path, tmpl.name].join(&quot;/&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">            when find_constant(&quot;ActiveRecord::Base&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="68">
          
          
          <code class="ruby">              string = &quot;#{item.class.name}(#{item.id})&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="70">
          
          
          <code class="ruby">              string = item.class.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">            string</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">        rescue Exception =&gt; ex</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="76">
          
          
          <code class="ruby">          &quot;...&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">    class TraceRecord</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">      include Render</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">        @start = Time.now</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">        @children = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_accessor :children</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :start</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">      def finish</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">        @finish ||= Time.now</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">      def time_in_children</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">        @children.inject(0) do |time, child|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="98">
          
          
          <code class="ruby">          time + child.duration</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">      def duration</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">        ((@finish - @start) * 1000).to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">      def to_json</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="107">
          
          
          <code class="ruby">        Yajl::Encoder.encode(hash_representation, :pretty =&gt; true, :indent =&gt; '  ')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">      private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">      # all timestamps in SpeedTracer are in milliseconds</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">      def range(start, finish)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">        {</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="114">
          <span class="hits">2</span>
          
          <code class="ruby">          'duration'  =&gt;  ((finish - start) * 1000).to_i,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">          'start'     =&gt;  [start.to_i,  start.usec/1000].join(''),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">          #'end'       =&gt;  [finish.to_i, finish.usec/1000].join('')</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="117">
          <span class="hits">2</span>
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">      def symbolize_hash(hash)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">        symbolled_hash = {}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">        hash.each_key do |key|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="123">
          <span class="hits">3</span>
          
          <code class="ruby">          if String === key</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="124">
          <span class="hits">3</span>
          
          <code class="ruby">            next if hash.has_key?(key.to_sym)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="125">
          <span class="hits">3</span>
          
          <code class="ruby">            symbolled_hash[key.to_sym] = hash[key]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">        hash.merge!(symbolled_hash)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">    class ServerEvent &lt; TraceRecord</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="133">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="135">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(method_call, arguments)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="136">
          
          
          <code class="ruby">        super()</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="137">
          
          
          <code class="ruby">        @arguments = arguments</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="138">
          
          
          <code class="ruby">        @name = &quot;#{method_call.context}#{method_call.kind == :instance ? &quot;#&quot; : &quot;::&quot;}#{method_call.method}(#{arguments})&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">      def hash_representation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">        {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">          'range' =&gt; range(@start, @finish),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">          'operation' =&gt;  {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">          #          'sourceCodeLocation' =&gt;  {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">          #          'className'   =&gt;  @file,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">          #          'methodName'  =&gt;  @method,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby">          #          'lineNumber'  =&gt;  @line</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">          #        },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">          'type' =&gt;  'METHOD',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">          'label' =&gt;  @name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">        },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">          'children' =&gt;  @children</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="154">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">      def to_html</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="158">
          
          
          <code class="ruby">        render_template('panels/speedtracer/serverevent',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">                        {:self_time =&gt; duration - time_in_children}.merge(symbolize_hash(hash_representation)))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">    class RequestRecord &lt; TraceRecord</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(id, method, uri)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">        super()</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">        @id = id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">        @method = method</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">        @uri = uri</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">        @event_id = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">      def uuid</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">        @id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">      def hash_representation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">        finish</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">        { 'trace' =&gt;  {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">          'url' =&gt; &quot;/__insight__/speedtracer?id=#@id&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">          'frameStack' =&gt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">            'range' =&gt; range(@start, @finish),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">            'operation' =&gt;  {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">            'type' =&gt;  'HTTP',</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">            'label' =&gt;  [@method, @uri].join(' ')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">          },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">            'children' =&gt;  @children</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">          }, #end frameStack</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">            'resources' =&gt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">            'Application' =&gt; '/', #Should get the Rails app name...</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">            'Application.endpoint' =&gt; '/' #Should get the env path thing</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">          }, #From what I can tell, Speed Tracer treats this whole hash as optional</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">            'range' =&gt;  range(@start, @finish)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="202">
          <span class="hits">1</span>
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="205">
          <span class="hits">1</span>
          
          <code class="ruby">      def to_html</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="206">
          <span class="hits">1</span>
          
          <code class="ruby">        hash = hash_representation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">        extra = {:self_time =&gt; duration - time_in_children}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">        &quot;&lt;a href='#{hash['trace']['url']}'&gt;Raw JSON&lt;/a&gt;\n&quot; +</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">          render_template('panels/speedtracer/serverevent', extra.merge(symbolize_hash(hash['trace']['frameStack'])))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1f9987f7b642c852956c0fad308087b10879b5a7">
  <div class="header">
    <h3>lib/insight/panels/sql_panel.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>27</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;digest&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  class SQLPanel &lt; Panel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    require &quot;insight/panels/sql_panel/panel_app&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    require &quot;insight/panels/sql_panel/query&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="75" data-linenumber="11">
          <span class="hits">75</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="75" data-linenumber="12">
          <span class="hits">75</span>
          
          <code class="ruby">      probe(self) do</code>
        </li>
      
        <li class="covered" data-hits="75" data-linenumber="13">
          <span class="hits">75</span>
          
          <code class="ruby">        %w{ PostgreSQLAdapter MysqlAdapter SQLiteAdapter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">            Mysql2Adapter OracleEnhancedAdapter }.each do |adapter|</code>
        </li>
      
        <li class="covered" data-hits="375" data-linenumber="15">
          <span class="hits">375</span>
          
          <code class="ruby">          instrument &quot;ActiveRecord::ConnectionAdapters::#{adapter}&quot; do</code>
        </li>
      
        <li class="covered" data-hits="375" data-linenumber="16">
          <span class="hits">375</span>
          
          <code class="ruby">            instance_probe :execute</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="75" data-linenumber="20">
          <span class="hits">75</span>
          
          <code class="ruby">      table_setup(&quot;sql_queries&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.panel_mappings</code>
        </li>
      
        <li class="covered" data-hits="75" data-linenumber="24">
          <span class="hits">75</span>
          
          <code class="ruby">      { &quot;sql&quot; =&gt; PanelApp.new }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    def after_detect(method_call, timing, arguments, results)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="28">
          <span class="hits">4</span>
          
          <code class="ruby">      store(@env, QueryResult.new(arguments.first, timing.duration, method_call.backtrace, results))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    def total_time(queries)</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="32">
          <span class="hits">55</span>
          
          <code class="ruby">      (queries.inject(0) do |memo, query|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="33">
          <span class="hits">4</span>
          
          <code class="ruby">        memo + query.time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      end)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">    def name</code>
        </li>
      
        <li class="covered" data-hits="230" data-linenumber="38">
          <span class="hits">230</span>
          
          <code class="ruby">      &quot;sql&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">    def heading_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="42">
          <span class="hits">55</span>
          
          <code class="ruby">      queries = retrieve(number)</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="43">
          <span class="hits">55</span>
          
          <code class="ruby">      &quot;#{queries.size} Queries (%.2fms)&quot; % total_time(queries)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">    def content_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="47">
          <span class="hits">55</span>
          
          <code class="ruby">      queries = retrieve(number)</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="48">
          <span class="hits">55</span>
          
          <code class="ruby">      render_template &quot;panels/sql&quot;, :queries =&gt; queries</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3893fd71f809d10bf38d2863e3c660e196548ea9">
  <div class="header">
    <h3>lib/insight/panels/sql_panel/panel_app.rb</h3>
    <h4><span class="red">77.27 %</span> covered</h4>
    <div>
      <b>22</b> relevant lines. 
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/panels/sql_panel/query'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  class SQLPanel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    class PanelApp &lt; ::Insight::PanelApp</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      def dispatch</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="9">
          <span class="hits">8</span>
          
          <code class="ruby">        case request.path_info</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="10">
          <span class="hits">4</span>
          
          <code class="ruby">        when &quot;/explain&quot; then explain_sql</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">        when &quot;/profile&quot; then profile_sql</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="12">
          <span class="hits">4</span>
          
          <code class="ruby">        when &quot;/execute&quot; then execute_sql</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="13">
          
          
          <code class="ruby">        else not_found</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">      def explain_sql</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="18">
          <span class="hits">4</span>
          
          <code class="ruby">        validate_params</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">        query = ExplainResult.new(params[&quot;query&quot;], params[&quot;time&quot;].to_f)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">        render_template &quot;panels/explain_sql&quot;, :query =&gt; query</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">      def profile_sql</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">        validate_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">        query = ProfileResult.new(params[&quot;query&quot;], params[&quot;time&quot;].to_f)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">        render_template &quot;panels/profile_sql&quot;, :query =&gt; query</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">      def execute_sql</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="30">
          <span class="hits">4</span>
          
          <code class="ruby">        validate_params</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">        query = QueryResult.new(params[&quot;query&quot;], params[&quot;time&quot;].to_f)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">        render_template &quot;panels/execute_sql&quot;, :query =&gt; query</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3a3dc28cc95a8c52d10d425f887303f6309a2d1b">
  <div class="header">
    <h3>lib/insight/panels/sql_panel/query.rb</h3>
    <h4><span class="red">74.0 %</span> covered</h4>
    <div>
      <b>50</b> relevant lines. 
      <span class="green"><b>37</b> lines covered</span> and
      <span class="red"><b>13</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class SQLPanel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    class QueryResult</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">      include Insight::FilteredBacktrace</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :sql</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(sql, time, backtrace = [], result=nil)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="11">
          <span class="hits">6</span>
          
          <code class="ruby">        @sql = sql</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="12">
          <span class="hits">6</span>
          
          <code class="ruby">        @time = time</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="13">
          <span class="hits">6</span>
          
          <code class="ruby">        @backtrace = backtrace</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="14">
          <span class="hits">6</span>
          
          <code class="ruby">        @result = result</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="15">
          <span class="hits">6</span>
          
          <code class="ruby">        @results = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">      def result</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="19">
          <span class="hits">8</span>
          
          <code class="ruby">        @results ||= execute</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="20">
          <span class="hits">8</span>
          
          <code class="ruby">        return @results</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">      def column_names</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">        if result.respond_to?(:fields)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">          return result.fields</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="27">
          <span class="hits">4</span>
          
          <code class="ruby">          return result.fetch_fields.map{|col| col.name}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">      def rows</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="32">
          <span class="hits">2</span>
          
          <code class="ruby">        if result.respond_to?(:values)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="33">
          
          
          <code class="ruby">          result.values</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="35">
          <span class="hits">2</span>
          
          <code class="ruby">          result.map do |row|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="36">
          <span class="hits">2</span>
          
          <code class="ruby">            row</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">      def human_time</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="42">
          <span class="hits">4</span>
          
          <code class="ruby">        &quot;%.2fms&quot; % (@time)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">      def inspectable?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="46">
          <span class="hits">4</span>
          
          <code class="ruby">        sql.strip =~ /^SELECT /i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      #Downside is: we re-execute the SQL...</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">      def self.execute(sql)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="51">
          <span class="hits">2</span>
          
          <code class="ruby">        ActiveRecord::Base.connection.execute(sql)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">      def execute</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">        self.class.execute(@sql)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">      def valid_hash?(secret_key, possible_hash)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="59">
          
          
          <code class="ruby">        hash = Digest::SHA1.hexdigest [secret_key, @sql].join(&quot;:&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="60">
          
          
          <code class="ruby">        possible_hash == hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">    class ExplainResult &lt; QueryResult</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">      def execute</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">        self.class.execute &quot;EXPLAIN #{@sql}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">    class ProfileResult &lt; QueryResult</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">      def with_profiling</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="72">
          
          
          <code class="ruby">        result = nil</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="73">
          
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="74">
          
          
          <code class="ruby">          self.class.execute(&quot;SET PROFILING=1&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="75">
          
          
          <code class="ruby">          result = yield</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">        ensure</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="77">
          
          
          <code class="ruby">          self.class.execute(&quot;SET PROFILING=0&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="79">
          
          
          <code class="ruby">        return result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">      def execute</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="83">
          
          
          <code class="ruby">        with_profiling do</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="84">
          
          
          <code class="ruby">          super</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="85">
          
          
          <code class="ruby">          self.class.execute &lt;&lt;-SQL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">              SELECT *</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">                FROM information_schema.profiling</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">               WHERE query_id = (SELECT query_id FROM information_schema.profiling ORDER BY query_id DESC LIMIT 1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">          SQL</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5288439a3472649b15047243f094ec72c405f3b7">
  <div class="header">
    <h3>lib/insight/panels/templates_panel.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>30</b> relevant lines. 
      <span class="green"><b>30</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  class TemplatesPanel &lt; Panel</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    require &quot;insight/panels/templates_panel/rendering&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="7">
          <span class="hits">63</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="9">
          <span class="hits">63</span>
          
          <code class="ruby">      probe(self) do</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="10">
          <span class="hits">63</span>
          
          <code class="ruby">        instrument &quot;ActionView::Template&quot; do</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="11">
          <span class="hits">63</span>
          
          <code class="ruby">          instance_probe :render</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="15">
          <span class="hits">63</span>
          
          <code class="ruby">      table_setup(&quot;templates&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="17">
          <span class="hits">63</span>
          
          <code class="ruby">      @current = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    def request_start(env, start)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="22">
          <span class="hits">50</span>
          
          <code class="ruby">      @current = Rendering.new(&quot;root&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    def request_finish(env, status, headers, body, timing)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="26">
          <span class="hits">50</span>
          
          <code class="ruby">      store(env, @current)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="27">
          <span class="hits">50</span>
          
          <code class="ruby">      @current = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    def before_detect(method_call, args)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="31">
          <span class="hits">8</span>
          
          <code class="ruby">      template_name = method_call.object.virtual_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="33">
          <span class="hits">8</span>
          
          <code class="ruby">      rendering = Rendering.new(template_name)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="34">
          <span class="hits">8</span>
          
          <code class="ruby">      @current.add(rendering)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="35">
          <span class="hits">8</span>
          
          <code class="ruby">      @current = rendering</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    def after_detect(method_call, timing, args, result)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="39">
          <span class="hits">8</span>
          
          <code class="ruby">      @current.timing = timing</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="40">
          <span class="hits">8</span>
          
          <code class="ruby">      @current = @current.parent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    def name</code>
        </li>
      
        <li class="covered" data-hits="212" data-linenumber="44">
          <span class="hits">212</span>
          
          <code class="ruby">      &quot;templates&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def heading_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="94" data-linenumber="48">
          <span class="hits">94</span>
          
          <code class="ruby">      &quot;Templates: %.2fms&quot; % (retrieve(number).inject(0.0){|memo, rendering| memo + rendering.duration})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">    def content_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="52">
          <span class="hits">50</span>
          
          <code class="ruby">      result = render_template &quot;panels/templates&quot;, :root_rendering =&gt; retrieve(number).first</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="53">
          <span class="hits">44</span>
          
          <code class="ruby">      return result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2625847df18fb0ba759df20526274737c9d86d3e">
  <div class="header">
    <h3>lib/insight/panels/templates_panel/rendering.rb</h3>
    <h4><span class="green">92.5 %</span> covered</h4>
    <div>
      <b>40</b> relevant lines. 
      <span class="green"><b>37</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class TemplatesPanel</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    class Rendering</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_accessor :name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_accessor :parent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_accessor :timing</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      attr_reader :children</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      def initialize(name, timing = nil)</code>
        </li>
      
        <li class="covered" data-hits="58" data-linenumber="11">
          <span class="hits">58</span>
          
          <code class="ruby">        @name = name</code>
        </li>
      
        <li class="covered" data-hits="58" data-linenumber="12">
          <span class="hits">58</span>
          
          <code class="ruby">        @timing = timing</code>
        </li>
      
        <li class="covered" data-hits="58" data-linenumber="13">
          <span class="hits">58</span>
          
          <code class="ruby">        @children = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">      def start_time</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">        @timing.start</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      alias_method :time, :start_time</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      def end_time</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="22">
          
          
          <code class="ruby">        @timing.end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">      def add(rendering)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="26">
          <span class="hits">8</span>
          
          <code class="ruby">        @children &lt;&lt; rendering</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="27">
          <span class="hits">8</span>
          
          <code class="ruby">        rendering.parent = self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">      def delete(rendering)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">        @children.delete(rendering)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      def duration</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="35">
          <span class="hits">63</span>
          
          <code class="ruby">        if @timing</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="36">
          <span class="hits">19</span>
          
          <code class="ruby">          @timing.duration</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="38">
          <span class="hits">44</span>
          
          <code class="ruby">          child_duration</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">      def exclusive_duration</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="43">
          <span class="hits">3</span>
          
          <code class="ruby">        duration - child_duration</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      def child_duration</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="47">
          <span class="hits">55</span>
          
          <code class="ruby">        children.inject(0.0) { |memo, c| memo + c.duration }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">      def duration_summary</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="51">
          <span class="hits">8</span>
          
          <code class="ruby">        if children.any?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="52">
          <span class="hits">3</span>
          
          <code class="ruby">          &quot;%.2fms, %.2f exclusive&quot; % [duration, exclusive_duration]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="54">
          <span class="hits">5</span>
          
          <code class="ruby">          &quot;%.2fms&quot; % (duration)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">      def html</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">        &lt;&lt;-HTML</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">            &lt;li&gt;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="60">
          <span class="hits">8</span>
          
          <code class="ruby">              &lt;p&gt;#{name} (#{duration_summary})&lt;/p&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">        #{children_html}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">            &lt;/li&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        HTML</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">      def children_html</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="68">
          <span class="hits">8</span>
          
          <code class="ruby">        return &quot;&quot; unless children.any?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">        &lt;&lt;-HTML</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="71">
          <span class="hits">3</span>
          
          <code class="ruby">            &lt;ul&gt;#{joined_children_html}&lt;/ul&gt;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">        HTML</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">      def joined_children_html</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="76">
          <span class="hits">6</span>
          
          <code class="ruby">        children.map { |c| c.html }.join</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a1d25d8922fbfef97f801fb247fc1b4818b1cec0">
  <div class="header">
    <h3>lib/insight/panels/timer_panel.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'benchmark'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  class TimerPanel &lt; Panel</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="6">
          <span class="hits">63</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="7">
          <span class="hits">63</span>
          
          <code class="ruby">      table_setup(&quot;timer&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    def name</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="11">
          <span class="hits">100</span>
          
          <code class="ruby">      &quot;timer&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def call(env)</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="15">
          <span class="hits">56</span>
          
          <code class="ruby">      status, headers, body = nil</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="16">
          <span class="hits">56</span>
          
          <code class="ruby">      @times = Benchmark.measure do</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="17">
          <span class="hits">56</span>
          
          <code class="ruby">        status, headers, body = @app.call(env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="20">
          <span class="hits">56</span>
          
          <code class="ruby">      store(env, [</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="21">
          <span class="hits">56</span>
          
          <code class="ruby">            [&quot;User CPU time&quot;,   &quot;%.2fms&quot; % (@times.utime * 1_000)],</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="22">
          <span class="hits">56</span>
          
          <code class="ruby">            [&quot;System CPU time&quot;, &quot;%.2fms&quot; % (@times.stime * 1_000)],</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="23">
          <span class="hits">56</span>
          
          <code class="ruby">            [&quot;Total CPU time&quot;,  &quot;%.2fms&quot; % (@times.total * 1_000)],</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="24">
          <span class="hits">56</span>
          
          <code class="ruby">            [&quot;Elapsed time&quot;,    &quot;%.2fms&quot; % (@times.real  * 1_000)]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      ])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="27">
          <span class="hits">56</span>
          
          <code class="ruby">      return [status, headers, body]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    def heading_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="31">
          <span class="hits">50</span>
          
          <code class="ruby">      measurements = retreive(number).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="33">
          <span class="hits">50</span>
          
          <code class="ruby">      measurements.last.last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    def content_for_request(number)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="37">
          <span class="hits">50</span>
          
          <code class="ruby">      render_template &quot;panels/timer&quot;, :measurements =&gt; retrieve(number).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2f2f36242edc54f10d0b0df7777ddf3fe4c08968">
  <div class="header">
    <h3>lib/insight/params_signature.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>32</b> relevant lines. 
      <span class="green"><b>32</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;digest&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  class ParamsSignature</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    extend ERB::Util</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.sign(request, hash)</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="9">
          <span class="hits">42</span>
          
          <code class="ruby">      parts = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="11">
          <span class="hits">42</span>
          
          <code class="ruby">      hash.keys.sort.each do |key|</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="12">
          <span class="hits">54</span>
          
          <code class="ruby">        parts &lt;&lt; &quot;#{key}=#{u(hash[key])}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="15">
          <span class="hits">42</span>
          
          <code class="ruby">      signature = new(request).signature(hash)</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="16">
          <span class="hits">42</span>
          
          <code class="ruby">      parts &lt;&lt; &quot;hash=#{u(signature)}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="18">
          <span class="hits">42</span>
          
          <code class="ruby">      parts.join(&quot;&amp;amp;&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :request</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(request)</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="24">
          <span class="hits">56</span>
          
          <code class="ruby">      @request = request</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    def secret_key</code>
        </li>
      
        <li class="covered" data-hits="78" data-linenumber="28">
          <span class="hits">78</span>
          
          <code class="ruby">      @request.env['insight.secret_key']</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    def secret_key_blank?</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="32">
          <span class="hits">14</span>
          
          <code class="ruby">      secret_key.nil? || secret_key == &quot;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">    def validate!</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="36">
          <span class="hits">14</span>
          
          <code class="ruby">      if secret_key_blank?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="37">
          <span class="hits">4</span>
          
          <code class="ruby">        raise SecurityError.new(&quot;Missing secret key&quot;)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="38">
          <span class="hits">10</span>
          
          <code class="ruby">      elsif request.params[&quot;hash&quot;] != signature(request.params)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="39">
          <span class="hits">2</span>
          
          <code class="ruby">        raise SecurityError.new(&quot;Invalid query hash.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    def signature(params)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="44">
          <span class="hits">52</span>
          
          <code class="ruby">      Digest::SHA1.hexdigest(signature_base(params))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def signature_base(params)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="48">
          <span class="hits">52</span>
          
          <code class="ruby">      signature = []</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="49">
          <span class="hits">52</span>
          
          <code class="ruby">      signature &lt;&lt; secret_key</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="51">
          <span class="hits">52</span>
          
          <code class="ruby">      params.keys.sort.each do |key|</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="52">
          <span class="hits">80</span>
          
          <code class="ruby">        next if key == &quot;hash&quot;</code>
        </li>
      
        <li class="covered" data-hits="70" data-linenumber="53">
          <span class="hits">70</span>
          
          <code class="ruby">        signature &lt;&lt; params[key].to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="56">
          <span class="hits">52</span>
          
          <code class="ruby">      signature.join(&quot;:&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="887235ba1a298cac744fcdda6337f05e47885dbb">
  <div class="header">
    <h3>lib/insight/path-filter.rb</h3>
    <h4><span class="yellow">84.62 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/logger'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  class PathFilter</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include Logging</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="7">
          <span class="hits">86</span>
          
          <code class="ruby">      @app = app</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    def call(env)</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="11">
          <span class="hits">71</span>
          
          <code class="ruby">      filters = env['insight.path_filters'].map do |string|</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="12">
          <span class="hits">71</span>
          
          <code class="ruby">        %r{^#{string}}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="142" data-linenumber="15">
          <span class="hits">142</span>
          
          <code class="ruby">      unless filter = filters.find{|regex| regex =~ env['PATH_INFO']}</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="16">
          <span class="hits">71</span>
          
          <code class="ruby">        return [404, {}, []]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">      logger.debug{ &quot;Shortcutting collection stack: #{filter} =~ #{env['PATH_INFO']}&quot;}</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="20">
          
          
          <code class="ruby">      return @app.call(env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="89c49cb34855886dbb9fd06f3d0cbf67a22468da">
  <div class="header">
    <h3>lib/insight/rack_static_bug_avoider.rb</h3>
    <h4><span class="red">44.44 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class RackStaticBugAvoider</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app, static_app)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">      @app = app</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">      @static_app = static_app</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def call(env)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      if env[&quot;PATH_INFO&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">        @static_app.call(env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">        @app.call(env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="934c41dc89d627c040d5e09a7ccc8395eafd1abb">
  <div class="header">
    <h3>lib/insight/redirect_interceptor.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class RedirectInterceptor</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Render</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="6">
          <span class="hits">86</span>
          
          <code class="ruby">      @app = app</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def call(env)</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="10">
          <span class="hits">65</span>
          
          <code class="ruby">      status, headers, body = @app.call(env)</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="11">
          <span class="hits">65</span>
          
          <code class="ruby">      @response = Rack::Response.new(body, status, headers)</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="12">
          <span class="hits">65</span>
          
          <code class="ruby">      if @response.redirect? &amp;&amp; env[&quot;insight.intercept_redirects&quot;]</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="13">
          <span class="hits">3</span>
          
          <code class="ruby">        intercept_redirect</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="15">
          <span class="hits">65</span>
          
          <code class="ruby">      @response.to_a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    def intercept_redirect</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="19">
          <span class="hits">3</span>
          
          <code class="ruby">      new_body = render_template(&quot;redirect&quot;, :redirect_to =&gt; @response.location)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="20">
          <span class="hits">3</span>
          
          <code class="ruby">      new_headers = { &quot;Content-Type&quot; =&gt; &quot;text/html&quot;, &quot;Content-Length&quot; =&gt; new_body.size.to_s }</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="21">
          <span class="hits">3</span>
          
          <code class="ruby">      @response = Rack::Response.new(new_body, 200, new_headers)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ad347f56a5e4bb4c2f66de6ebd1acdccf6fbcba7">
  <div class="header">
    <h3>lib/insight/render.rb</h3>
    <h4><span class="green">91.67 %</span> covered</h4>
    <div>
      <b>36</b> relevant lines. 
      <span class="green"><b>33</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'erb'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  module Render</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    include ERB::Util</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    include Logging</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def signed_params(hash)</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="9">
          <span class="hits">42</span>
          
          <code class="ruby">      ParamsSignature.sign(request, hash)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    module CompiledTemplates</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    include CompiledTemplates</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    def render_template(filename, local_assigns = {})</code>
        </li>
      
        <li class="covered" data-hits="578" data-linenumber="17">
          <span class="hits">578</span>
          
          <code class="ruby">      compile(filename, local_assigns)</code>
        </li>
      
        <li class="covered" data-hits="578" data-linenumber="18">
          <span class="hits">578</span>
          
          <code class="ruby">      render_symbol = method_name(filename, local_assigns)</code>
        </li>
      
        <li class="covered" data-hits="578" data-linenumber="19">
          <span class="hits">578</span>
          
          <code class="ruby">      send(render_symbol, local_assigns)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    def compile(filename, local_assigns)</code>
        </li>
      
        <li class="covered" data-hits="578" data-linenumber="23">
          <span class="hits">578</span>
          
          <code class="ruby">      render_symbol = method_name(filename, local_assigns)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="578" data-linenumber="25">
          <span class="hits">578</span>
          
          <code class="ruby">      if !CompiledTemplates.instance_methods.include?(render_symbol.to_s)</code>
        </li>
      
        <li class="covered" data-hits="578" data-linenumber="26">
          <span class="hits">578</span>
          
          <code class="ruby">        compile!(filename, local_assigns)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    def compile!(filename, local_assigns)</code>
        </li>
      
        <li class="covered" data-hits="578" data-linenumber="31">
          <span class="hits">578</span>
          
          <code class="ruby">      render_symbol = method_name(filename, local_assigns)</code>
        </li>
      
        <li class="covered" data-hits="1489" data-linenumber="32">
          <span class="hits">1489</span>
          
          <code class="ruby">      locals_code = local_assigns.keys.map { |key| &quot;#{key} = local_assigns[:#{key}];&quot; }.join</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="578" data-linenumber="34">
          <span class="hits">578</span>
          
          <code class="ruby">      source = &lt;&lt;-end_src</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      def #{render_symbol}(local_assigns)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">        #{locals_code}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">        #{compiled_source(filename)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      end_src</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="578" data-linenumber="41">
          <span class="hits">578</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="578" data-linenumber="42">
          <span class="hits">578</span>
          
          <code class="ruby">        CompiledTemplates.module_eval(source, filename, 0)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="43">
          
          
          <code class="ruby">      rescue Object =&gt; ex</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">        logger.debug do</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">          &quot;#{ex.class.name}: #{ex.message} in\n&quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">          source +</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="47">
          
          
          <code class="ruby">            ex.backtrace.join(&quot;\n&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">    def compiled_source(filename)</code>
        </li>
      
        <li class="covered" data-hits="578" data-linenumber="53">
          <span class="hits">578</span>
          
          <code class="ruby">      ::ERB.new(::File.read(::File.dirname(__FILE__) + &quot;/views/#{filename}.html.erb&quot;), nil, &quot;-&quot;).src</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">    def method_name(filename, local_assigns)</code>
        </li>
      
        <li class="covered" data-hits="1734" data-linenumber="57">
          <span class="hits">1734</span>
          
          <code class="ruby">      if local_assigns &amp;&amp; local_assigns.any?</code>
        </li>
      
        <li class="covered" data-hits="1716" data-linenumber="58">
          <span class="hits">1716</span>
          
          <code class="ruby">        method_name = method_name_without_locals(filename).dup</code>
        </li>
      
        <li class="covered" data-hits="4449" data-linenumber="59">
          <span class="hits">4449</span>
          
          <code class="ruby">        method_name &lt;&lt; &quot;_locals_#{local_assigns.keys.map { |k| k.to_s }.sort.join('_')}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="61">
          <span class="hits">18</span>
          
          <code class="ruby">        method_name = method_name_without_locals(filename)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1734" data-linenumber="63">
          <span class="hits">1734</span>
          
          <code class="ruby">      method_name.to_sym</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">    def method_name_without_locals(filename)</code>
        </li>
      
        <li class="covered" data-hits="1734" data-linenumber="67">
          <span class="hits">1734</span>
          
          <code class="ruby">      filename.split(&quot;/&quot;).join(&quot;_&quot;).tr(&quot;-&quot;, &quot;_&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="84f6f7469cd9985c72f9b32cdf91b911abeeccdc">
  <div class="header">
    <h3>lib/insight/request-recorder.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight'</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight/database'</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  class RequestRecorder</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="7">
          <span class="hits">86</span>
          
          <code class="ruby">      @app = app</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="8">
          <span class="hits">86</span>
          
          <code class="ruby">      @request_table = Database::RequestTable.new()</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    def call(env)</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="12">
          <span class="hits">71</span>
          
          <code class="ruby">      env[&quot;insight.request-id&quot;] =</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">        @request_table.store(env[&quot;REQUEST_METHOD&quot;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">                             env[&quot;PATH_INFO&quot;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="16">
          <span class="hits">71</span>
          
          <code class="ruby">      results = @app.call(env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="18">
          <span class="hits">71</span>
          
          <code class="ruby">      @request_table.sweep</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="20">
          <span class="hits">71</span>
          
          <code class="ruby">      return results</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a346209d926c6bc1b6984ed0bcf97108a66ec869">
  <div class="header">
    <h3>lib/insight/toolbar.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>35</b> relevant lines. 
      <span class="green"><b>35</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Insight</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Toolbar</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    include Render</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    include Logging</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    MIME_TYPES = [&quot;text/html&quot;, &quot;application/xhtml+xml&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(app, insight)</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="9">
          <span class="hits">86</span>
          
          <code class="ruby">      @app = app</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="10">
          <span class="hits">86</span>
          
          <code class="ruby">      @insight = insight</code>
        </li>
      
        <li class="covered" data-hits="86" data-linenumber="11">
          <span class="hits">86</span>
          
          <code class="ruby">      @request_table = Database::RequestTable.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def call(env)</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="15">
          <span class="hits">80</span>
          
          <code class="ruby">      @env = env</code>
        </li>
      
        <li class="covered" data-hits="80" data-linenumber="16">
          <span class="hits">80</span>
          
          <code class="ruby">      status, headers, body = @app.call(@env)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="18">
          <span class="hits">74</span>
          
          <code class="ruby">      response = Rack::Response.new(body, status, headers)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="20">
          <span class="hits">74</span>
          
          <code class="ruby">      if okay_to_modify?(env, response)</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="21">
          <span class="hits">66</span>
          
          <code class="ruby">        inject_toolbar(response)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="24">
          <span class="hits">74</span>
          
          <code class="ruby">      return response.to_a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    def okay_to_modify?(env, response)</code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="28">
          <span class="hits">74</span>
          
          <code class="ruby">      req = Rack::Request.new(env)</code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="29">
          <span class="hits">74</span>
          
          <code class="ruby">      content_type, charset = response.content_type.split(&quot;;&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="31">
          <span class="hits">74</span>
          
          <code class="ruby">      response.ok? &amp;&amp; MIME_TYPES.include?(content_type) &amp;&amp; !req.xhr?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    def inject_toolbar(response)</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="35">
          <span class="hits">66</span>
          
          <code class="ruby">      full_body = response.body.join</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="36">
          <span class="hits">66</span>
          
          <code class="ruby">      full_body.sub! /&lt;\/body&gt;/, render + &quot;&lt;/body&gt;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="38">
          <span class="hits">66</span>
          
          <code class="ruby">      response[&quot;Content-Length&quot;] = full_body.size.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      # Ensure that browser doesn't cache</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="41">
          <span class="hits">66</span>
          
          <code class="ruby">      response[&quot;Etag&quot;] = &quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="42">
          <span class="hits">66</span>
          
          <code class="ruby">      response[&quot;Cache-Control&quot;] = &quot;no-cache&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="44">
          <span class="hits">66</span>
          
          <code class="ruby">      response.body = [full_body]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def render</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="48">
          <span class="hits">66</span>
          
          <code class="ruby">      req_id = (@env['insight.request-id'] || @request_table.last_request_id).to_i</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="49">
          <span class="hits">66</span>
          
          <code class="ruby">      requests = @request_table.to_a.map do |row|</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="50">
          <span class="hits">71</span>
          
          <code class="ruby">        { :id =&gt; row[0], :method =&gt; row[1], :path =&gt; row[2] }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="598" data-linenumber="53">
          <span class="hits">598</span>
          
          <code class="ruby">      logger.info{ &quot;Injecting toolbar: active panels: #{@insight.panels.map{|pnl| pnl.class.name}.inspect}&quot; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="55">
          <span class="hits">66</span>
          
          <code class="ruby">      headers_fragment = render_template(&quot;headers_fragment&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">                                         :panels =&gt; @insight.panels,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">                                         :request_id =&gt; req_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="59">
          <span class="hits">66</span>
          
          <code class="ruby">      current_request_fragment = render_template(&quot;request_fragment&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">                                                 :request_id =&gt; req_id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">                                                 :requests =&gt; requests,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">                                                 :panels =&gt; @insight.panels)</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="63">
          <span class="hits">66</span>
          
          <code class="ruby">      render_template(&quot;toolbar&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">                      :request_fragment =&gt; current_request_fragment,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">                      :headers_fragment =&gt; headers_fragment,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">                      :request_id =&gt; req_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ee5f27329dbb4fb81e60ca758dfd2cc39372d0c7">
  <div class="header">
    <h3>lib/logical-insight.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require 'insight'</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>
